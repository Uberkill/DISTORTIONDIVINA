<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DISTORTION CORP // SECURE TERMINAL</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Share+Tech+Mono&family=Noto+Sans+JP:wght@400;700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #050505;
            --gold-primary: #D4AF37;
            --gold-dim: #8a7020;
            --terminal-green: #33ff00;
            --glitch-red: #ff003c;
            --glitch-blue: #00f0ff;
            --window-bg: rgba(10, 10, 10, 0.98);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            cursor: default;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Focus styles for accessibility */
        *:focus-visible {
            outline: 2px solid var(--terminal-green);
            outline-offset: 2px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--gold-primary);
            font-family: 'Share Tech Mono', 'Noto Sans KR', 'Noto Sans JP', monospace;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
            perspective: 1000px;
            font-size: 18px; /* Increased base font size */
        }

        /* --- CONTAINER FOR ROTATION --- */
        #app-container {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: transform 0.5s ease, width 0.5s ease, height 0.5s ease;
            transform-origin: center center;
        }

        /* Rotated State Class */
        #app-container.rotated {
            width: 100vh;
            height: 100vw;
            transform: rotate(90deg) translate((50vw - 50vh), (50vh - 50vw));
            position: fixed;
            top: 50%;
            left: 50%;
            translate: -50% -50%;
        }

        /* --- VISUAL EFFECTS --- */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9999;
            background: 
                linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 3px 100%;
            animation: flicker 0.03s infinite;
            opacity: 0.8;
        }

        .vignette {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 9998;
            /* Lighter vignette settings */
            background: radial-gradient(circle, rgba(0,0,0,0) 55%, rgba(0,0,0,0.6) 150%);
            box-shadow: inset 0 0 80px rgba(0,0,0,0.5);
        }

        body { text-shadow: 0 0 2px rgba(212, 175, 55, 0.5); }

        /* --- MODE SWITCH BUTTON --- */
        .mode-switch-btn {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--terminal-green); /* Changed to green for visibility */
            color: var(--terminal-green);
            font-size: 1rem;
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Share Tech Mono';
            margin-right: 15px;
            transition: all 0.2s;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 5px rgba(51, 255, 0, 0.2);
        }
        .mode-switch-btn:hover {
            background: var(--terminal-green);
            color: black;
            box-shadow: 0 0 15px var(--terminal-green);
        }

        /* --- MOBILE CONTROLS (Rotation) --- */
        #mobile-controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 10000;
            display: none; /* Default hidden, shown via .is-mobile class */
        }

        .mobile-btn {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--gold-primary);
            color: var(--gold-primary);
            padding: 10px 16px; /* Increased */
            font-family: 'Share Tech Mono';
            font-size: 1rem; /* Increased */
            border-radius: 4px;
            cursor: pointer;
            backdrop-filter: blur(4px);
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease-in-out;
            /* Added radial gradient for depth */
            background: radial-gradient(circle at center, #111 0%, #000 70%);
        }

        .login-title {
            font-family: 'Cinzel'; 
            margin-bottom: 30px; 
            color: var(--gold-primary); 
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.6); 
            font-size: 4.5rem; 
            letter-spacing: 8px;
            text-align: center;
            font-weight: 700;
            animation: fadeIn 2s ease-out;
        }

        .login-box {
            border: 1px solid rgba(212, 175, 55, 0.3);
            padding: 40px 50px;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            background: rgba(5, 5, 5, 0.85); /* Slightly more transparent */
            max-width: 550px;
            width: 90%;
            position: relative;
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- NEW LOGIN BAR STYLES --- */
        .login-input-wrapper {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
            border-bottom: 2px solid var(--gold-dim);
            transition: all 0.3s;
        }

        .login-input-wrapper.focused {
            border-bottom-color: var(--gold-primary);
            box-shadow: 0 10px 20px -10px rgba(212, 175, 55, 0.2);
        }

        .login-input-container {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px 15px;
        }

        .input-prefix {
            color: var(--gold-dim);
            font-family: 'Share Tech Mono';
            margin-right: 10px;
            font-size: 1.1rem;
            animation: blink 1s infinite;
        }

        .login-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--gold-primary);
            font-family: 'Share Tech Mono';
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            outline: none;
        }

        .login-input::placeholder {
            color: rgba(212, 175, 55, 0.3);
        }

        .login-submit-btn {
            background: transparent;
            border: none;
            color: var(--gold-dim);
            cursor: pointer;
            transition: all 0.2s;
            padding: 5px;
        }
        .login-submit-btn:hover {
            color: var(--gold-primary);
            transform: translateX(3px);
            text-shadow: 0 0 5px var(--gold-primary);
        }

        .login-msg {
            height: 20px;
            margin-top: 15px;
            font-family: 'Share Tech Mono';
            font-size: 0.9rem;
            color: var(--terminal-green);
            opacity: 0;
            transition: opacity 0.3s;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* REMOVED: .login-box::after (The scanning effect) */

        .lang-selector {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 35px;
            border-bottom: 1px solid var(--gold-dim);
            padding-bottom: 25px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .lang-btn {
            background: transparent;
            border: 1px solid var(--gold-dim);
            color: #666;
            padding: 8px 20px; /* Increased */
            font-family: 'Share Tech Mono', monospace;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem; /* Increased */
        }

        .lang-btn.active, .lang-btn:hover {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
            text-shadow: 0 0 5px var(--gold-primary);
        }

        /* REMOVED OLD enter-btn STYLES */

        /* --- DESKTOP ENVIRONMENT --- */
        #desktop-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 50% 50%, #151515 0%, #000 100%),
                repeating-linear-gradient(0deg, transparent, transparent 1px, rgba(212, 175, 55, 0.02) 1px, rgba(212, 175, 55, 0.02) 2px);
            opacity: 0;
            transition: opacity 2s ease;
            pointer-events: none; 
        }

        #desktop-screen.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Top Bar */
        .os-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            height: 70px; /* Increased height */
            background: #0a0a0a;
            border-bottom: 1px solid var(--gold-dim);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px; /* Increased padding */
            font-size: 1rem; /* Increased font */
            color: #666;
            z-index: 100;
        }

        /* --- SIGNAL WIDGET STYLES (Bottom Right) --- */
        .top-right-group {
            display: flex;
            align-items: center;
            gap: 25px; /* Increased */
            font-size: 1.2rem; /* Clock size */
        }

        .signal-widget {
            display: flex;
            align-items: center;
            gap: 12px; /* Increased */
            border-left: 1px solid #333;
            padding-left: 20px; /* Increased */
            padding-right: 20px; /* Increased */
            height: 100%;
            margin-left: auto;
            background: rgba(0, 0, 0, 0.2);
            font-size: 0.85rem; /* Increased */
        }

        .signal-graph {
            display: flex;
            align-items: flex-end;
            gap: 3px;
            height: 20px; /* Increased */
            width: 25px; /* Increased */
        }

        .sig-bar {
            width: 4px; /* Increased */
            background: var(--gold-dim);
            animation: sig-pulse 1s infinite alternate;
            opacity: 0.5;
        }
        .sig-bar:nth-child(1) { height: 40%; animation-delay: 0.1s; }
        .sig-bar:nth-child(2) { height: 70%; animation-delay: 0.3s; }
        .sig-bar:nth-child(3) { height: 100%; animation-delay: 0.0s; background: var(--terminal-green); opacity: 0.8; }
        .sig-bar:nth-child(4) { height: 60%; animation-delay: 0.5s; }

        .signal-data {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-family: 'Share Tech Mono';
            line-height: 1;
            opacity: 0.8;
        }

        .sig-label {
            font-size: 0.65rem; /* Increased */
            color: #555;
            margin-bottom: 2px;
            text-transform: uppercase;
        }

        .sig-value {
            font-size: 0.85rem; /* Increased */
            color: var(--terminal-green);
            text-shadow: none;
        }

        .enc-hash {
            font-family: monospace;
            font-size: 0.75rem; /* Increased */
            color: #666;
            width: 90px; /* Increased */
            overflow: hidden;
            white-space: nowrap;
            text-align: right;
        }

        @keyframes sig-pulse {
            0% { opacity: 0.3; height: 30%; }
            100% { opacity: 0.7; height: 100%; }
        }

        /* Bottom Taskbar */
        .taskbar {
            position: absolute;
            bottom: 0; left: 0; width: 100%;
            height: 55px; /* Increased height */
            background: #0a0a0a;
            border-top: 1px solid var(--gold-dim);
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: 9000;
        }

        .start-btn {
            height: 40px; /* Increased */
            padding: 0 20px; /* Increased */
            background: var(--gold-dim);
            color: black;
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1rem; /* Increased */
            margin-right: 15px;
            cursor: pointer;
        }
        .start-btn:hover { background: var(--gold-primary); }

        .task-item {
            height: 40px; /* Increased */
            padding: 0 20px; /* Increased */
            margin-right: 8px;
            border: 1px solid #333;
            color: #888;
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95rem; /* Increased */
            min-width: 120px; /* Increased */
            background: #111;
        }
        .task-item:hover { background: #222; color: #ccc; }
        .task-item.active {
            border-color: var(--gold-dim);
            color: var(--gold-primary);
            background: #1a1a1a;
            box-shadow: inset 0 -2px 0 var(--gold-primary);
        }

        /* Desktop Icons */
        .desktop-icons-container {
            position: absolute;
            top: 90px; /* Pushed down due to bigger top bar */
            left: 40px; /* Increased margin */
            display: flex;
            flex-direction: column;
            gap: 50px; /* Increased gap */
            z-index: 50;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 180px; /* Increased width */
            cursor: pointer;
            text-align: center;
            color: var(--gold-primary);
            opacity: 0.8;
            transition: all 0.2s;
        }

        .desktop-icon:hover, .desktop-icon:focus {
            opacity: 1;
            text-shadow: 0 0 10px var(--gold-primary);
            transform: scale(1.05);
            outline: none;
        }
        .desktop-icon:focus .icon-img {
            border: 1px dashed var(--gold-dim);
            background: rgba(212, 175, 55, 0.15);
        }

        .icon-img {
            width: 100px; /* Increased */
            height: 100px; /* Increased */
            margin-bottom: 15px; /* Increased */
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.3);
            border-radius: 8px; /* Slightly rounder */
        }
        
        .desktop-icon:hover .icon-img {
            border: 1px dashed var(--gold-dim);
            background: rgba(212, 175, 55, 0.15);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.1);
        }

        .icon-label {
            font-size: 1.1rem; /* Increased */
            line-height: 1.2;
            background: rgba(0,0,0,0.6);
            padding: 6px 10px; /* Increased */
            border-radius: 6px;
        }

        /* --- OS WINDOWS --- */
        .os-window {
            position: absolute;
            background: var(--window-bg);
            border: 1px solid var(--gold-dim);
            box-shadow: 0 0 40px rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            resize: both;
            overflow: hidden;
            min-width: 350px; /* Increased */
            min-height: 250px; /* Increased */
        }

        /* Draggable Header */
        .window-header {
            height: 42px; /* Increased */
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.1), rgba(0,0,0,0.8));
            border-bottom: 1px solid var(--gold-dim);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px; /* Increased */
            cursor: grab; 
            user-select: none;
        }
        .window-header:active { cursor: grabbing; }

        .os-window.active {
            display: flex;
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.15), 0 0 0 1px var(--gold-dim);
            z-index: 101; /* Ensure active window is on top */
        }
        
        .os-window.minimized {
            display: none !important;
        }

        .os-window.maximized {
            transition: all 0.3s ease; /* Smooth transition for maximizing */
        }

        .win-title {
            font-size: 1rem; /* Increased */
            text-transform: uppercase;
            letter-spacing: 1px;
            pointer-events: none;
        }

        .win-controls {
            display: flex;
            gap: 8px; /* Increased */
        }

        .win-btn {
            width: 24px; height: 24px; /* Increased */
            border: 1px solid var(--gold-dim);
            background: black;
            color: var(--gold-dim);
            font-size: 14px; /* Increased */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .win-btn:hover { background: var(--gold-primary); color: black; }
        .win-btn.close:hover { background: var(--glitch-red); border-color: red; color: white; }

        .window-content {
            flex: 1;
            overflow-y: auto;
            padding: 25px; /* Increased */
            position: relative;
            scrollbar-width: thin;
            scrollbar-color: var(--gold-dim) #111;
        }
        
        .window-content::-webkit-scrollbar { width: 8px; }
        .window-content::-webkit-scrollbar-track { background: #111; }
        .window-content::-webkit-scrollbar-thumb { background: var(--gold-dim); }

        /* --- PROJECT BRIEF / MISSION FILE STYLES --- */
        .brief-layout {
            display: flex;
            flex-direction: column;
            gap: 25px; /* Increased */
        }
        
        .brief-meta {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid var(--gold-dim);
            padding-bottom: 10px; /* Increased */
            margin-bottom: 15px; /* Increased */
            font-size: 0.9rem; /* Increased */
            color: var(--terminal-green);
            font-family: 'Share Tech Mono';
        }

        .brief-text-col {
            flex: 1;
        }

        .brief-visual-col {
            flex: 0 0 400px; /* Increased width */
            display: flex;
            flex-direction: column;
        }

        .brief-frame {
            border: 1px solid var(--gold-primary);
            padding: 6px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .brief-frame::before, .brief-frame::after {
            content: ''; position: absolute; width: 10px; height: 10px; /* Increased */
            border: 1px solid var(--gold-primary);
            transition: all 0.3s;
        }
        .brief-frame::before { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .brief-frame::after { bottom: -1px; right: -1px; border-left: none; border-top: none; }

        .brief-img {
            width: 100%;
            height: 300px; /* Increased */
            object-fit: cover;
            background: #111;
            display: block;
            filter: grayscale(80%) sepia(20%);
            transition: filter 0.3s;
        }
        .brief-frame:hover .brief-img { filter: grayscale(0%); }

        .brief-caption {
            background: var(--gold-dim);
            color: black;
            font-size: 0.8rem; /* Increased */
            padding: 4px 6px;
            text-align: center;
            font-weight: bold;
            margin-top: 6px;
        }

        @media(min-width: 768px) {
            .brief-layout {
                flex-direction: row;
            }
        }

        /* --- CONTENT STYLES --- */
        .archive-header {
            display: flex;
            gap: 25px; /* Increased */
            margin-bottom: 35px; /* Increased */
            border-bottom: 1px solid var(--gold-dim);
            padding-bottom: 25px; /* Increased */
        }
        .archive-header-img {
            width: 240px; /* Increased */
            height: 360px; /* Increased */
            background: #000;
            border: 1px solid var(--gold-primary);
            flex-shrink: 0;
            overflow: hidden;
        }
        .archive-header-text {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .archive-header h2 {
            font-family: 'Cinzel';
            font-size: 3rem; /* Increased */
            color: var(--gold-primary);
            margin-bottom: 15px;
        }
        .archive-header p {
            font-size: 1.1rem; /* Increased */
            color: #ccc;
            line-height: 1.6;
        }

        /* RATES DASHBOARD STYLES */
        .rates-dashboard {
            margin-top: 20px; /* Increased */
            border: 1px solid rgba(212, 175, 55, 0.3);
            background: rgba(0, 0, 0, 0.4);
            padding: 20px; /* Increased */
            display: flex;
            flex-direction: column;
            gap: 20px; /* Increased */
        }

        .rates-section-title {
            font-family: 'Share Tech Mono';
            font-size: 0.95rem; /* Increased */
            color: var(--gold-dim);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
            padding-bottom: 8px; /* Increased */
            margin-bottom: 10px; /* Increased */
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pack-config {
            display: flex;
            gap: 15px; /* Increased */
            align-items: center;
        }

        .config-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px; /* Increased */
            padding: 6px 12px; /* Increased */
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #333;
            font-size: 0.9rem; /* Increased */
            color: #eee;
        }
        
        .config-badge.holo { border-color: var(--glitch-blue); color: var(--glitch-blue); }
        .config-badge.norm { border-color: #888; color: #aaa; }

        .rates-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px; /* Increased */
        }

        .rate-card {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px; /* Increased */
            border-left: 3px solid #333; /* Increased */
        }
        
        .rate-card.holo { border-left-color: var(--glitch-blue); }
        .rate-card.norm { border-left-color: #888; }

        .rate-value {
            display: block;
            font-size: 1.6rem; /* Increased */
            font-weight: bold;
            color: #fff;
            font-family: 'Cinzel';
        }
        .rate-sub {
            display: block;
            font-size: 0.85rem; /* Increased */
            color: #666;
            font-family: 'Share Tech Mono';
        }
        .rate-label {
            display: block;
            font-size: 0.8rem; /* Increased */
            color: var(--gold-dim);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .archive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* Increased min width */
            gap: 20px; /* Increased gap */
        }

        .card-file {
            position: relative;
            border: 1px solid #333;
            background: rgba(255,255,255,0.02);
            height: 350px; /* Increased height */
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }

        .card-file:hover, .card-file:focus {
            border-color: var(--gold-primary);
            background: rgba(212, 175, 55, 0.05);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.15); /* Increased */
            outline: none;
        }

        .card-file img {
            width: 100%; height: 100%; object-fit: cover;
            filter: grayscale(100%);
            opacity: 0.7; /* Default fallback */
            transition: all 0.3s;
        }
        
        /* LAZY LOAD STYLES */
        .img-loading { opacity: 0 !important; transition: opacity 0.5s ease; }
        .img-loaded { opacity: 0.7 !important; }

        .card-file:hover img.img-loaded, .card-file:focus img.img-loaded {
            filter: grayscale(0%);
            opacity: 1 !important;
            transform: scale(1.05);
        }

        .file-label {
            position: absolute; bottom: 0; width: 100%;
            background: rgba(0,0,0,0.8);
            color: #fff;
            font-size: 0.9rem; /* Increased */
            padding: 8px; /* Increased */
            text-align: center;
            border-top: 1px solid #333;
        }
        .card-file:hover .file-label, .card-file:focus .file-label {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        /* --- SHOP / EVENT LOG STYLES --- */
        .shop-item {
            border: 1px solid var(--gold-dim);
            padding: 25px; /* Increased */
            margin-bottom: 25px; /* Increased */
            background: rgba(0,0,0,0.5);
            transition: transform 0.2s;
        }
        .shop-item:hover {
            transform: translateX(5px);
            background: rgba(212,175,55,0.05);
            border-color: var(--gold-primary);
        }

        .shop-link-btn {
            display: inline-block;
            margin-top: 12px;
            font-size: 0.85rem; /* Increased */
            color: var(--terminal-green);
            border: 1px solid var(--terminal-green);
            padding: 6px 12px; /* Increased */
            text-decoration: none;
            background: rgba(0,0,0,0.3);
            transition: all 0.2s;
        }
        .shop-link-btn:hover {
            background: var(--terminal-green);
            color: black;
        }

        /* --- EMPLOYEE LIST STYLES --- */
        .employee-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1rem; /* Increased */
            color: #ccc;
        }
        .employee-table thead tr {
            background: rgba(212, 175, 55, 0.1);
            border-bottom: 2px solid var(--gold-primary);
        }
        .employee-table th {
            text-align: left;
            border-bottom: 1px solid var(--gold-primary);
            padding: 15px 12px; /* Increased padding */
            color: var(--gold-primary);
            font-family: 'Cinzel';
            font-weight: bold;
            font-size: 1.1rem; /* Increased */
            /* Sticky Header for Desktop */
            position: sticky;
            top: 0;
            background: #0f0f0f; /* Matches dark background to cover content when scrolling */
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .employee-table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background 0.2s;
        }
        /* Zebra Striping */
        .employee-table tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }
        .employee-table tbody tr:hover {
            background: rgba(212, 175, 55, 0.15);
        }
        .employee-table td {
            padding: 12px; /* Increased */
            vertical-align: middle;
        }
        
        /* Column specific styles for readability */
        .col-no { color: #666; font-family: 'Share Tech Mono'; }
        .col-card { color: #fff; font-weight: bold; }
        .col-char { color: var(--terminal-green); }
        .col-emp { color: var(--gold-dim); }
        .col-pen { color: #888; font-style: italic; font-size: 0.9rem; /* Increased */ }
        
        /* Role Badge Style */
        .role-badge {
            display: inline-block;
            padding: 4px 10px; /* Increased */
            border-radius: 4px;
            background: rgba(0, 240, 255, 0.1);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: var(--glitch-blue);
            font-size: 0.85rem; /* Increased */
            font-family: 'Share Tech Mono';
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        /* --- ASSISTANT CHARACTER STYLES --- */
        #assistant-overlay {
            position: fixed;
            bottom: 80px; /* Pushed up */
            right: 40px; /* Increased margin */
            width: 320px; /* Increased width */
            z-index: 8000;
            display: none; /* hidden by default */
            flex-direction: column;
            align-items: flex-end;
            pointer-events: none; /* Allow clicking through empty space */
        }

        #assistant-overlay.active { display: flex; }

        .assistant-avatar {
            width: 100px; /* Increased */
            height: 100px; /* Increased */
            border: 2px solid var(--gold-primary);
            background: #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            margin-bottom: 12px;
            animation: float 3s ease-in-out infinite;
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }

        .assistant-avatar::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(212, 175, 55, 0.4), transparent);
        }

        .assistant-avatar svg {
            animation: talk-pulse 0.5s infinite alternate;
            width: 48px; height: 48px; /* Bigger Icon inside */
        }

        .assistant-bubble {
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid var(--gold-primary);
            padding: 20px; /* Increased */
            border-radius: 12px 12px 0 12px;
            color: var(--gold-primary);
            font-size: 1rem; /* Increased */
            line-height: 1.5;
            margin-bottom: 12px;
            position: relative;
            pointer-events: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            max-width: 100%;
            animation: popIn 0.3s ease-out;
        }

        .assistant-controls {
            margin-top: 15px; /* Increased */
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .assistant-btn {
            border: 1px solid var(--gold-dim);
            background: transparent;
            color: #888;
            font-size: 0.85rem; /* Increased */
            padding: 5px 12px; /* Increased */
            cursor: pointer;
            font-family: 'Share Tech Mono';
        }
        .assistant-btn:hover { background: var(--gold-dim); color: #000; }

        /* --- AUDIO PLAYER STYLES --- */
        .visualizer-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 70px; /* Increased */
            background: #111;
            padding: 6px;
            border: 1px solid #333;
            margin-bottom: 15px;
        }

        .bar {
            width: 8%;
            background: var(--gold-primary);
            height: 10%;
            transition: height 0.1s;
        }

        .playing .bar {
            animation: equalize 0.5s infinite alternate;
        }
        /* Staggered animation delays for bars */
        .bar:nth-child(1) { animation-delay: 0.1s; }
        .bar:nth-child(2) { animation-delay: 0.3s; }
        .bar:nth-child(3) { animation-delay: 0.0s; }
        .bar:nth-child(4) { animation-delay: 0.4s; }
        .bar:nth-child(5) { animation-delay: 0.2s; }
        .bar:nth-child(6) { animation-delay: 0.5s; }
        .bar:nth-child(7) { animation-delay: 0.1s; }
        .bar:nth-child(8) { animation-delay: 0.3s; }
        .bar:nth-child(9) { animation-delay: 0.0s; }
        .bar:nth-child(10) { animation-delay: 0.4s; }

        .player-controls {
            display: flex;
            justify-content: center;
            gap: 20px; /* Increased */
            margin-bottom: 15px;
        }

        .ctrl-btn {
            background: transparent;
            border: 1px solid var(--gold-primary);
            color: var(--gold-primary);
            width: 48px; height: 48px; /* Increased */
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            border-radius: 50%;
        }
        .ctrl-btn:hover { background: var(--gold-primary); color: black; box-shadow: 0 0 10px var(--gold-primary); }

        .track-info {
            text-align: center;
            color: var(--terminal-green);
            font-size: 0.95rem; /* Increased */
            border: 1px solid #333;
            padding: 8px; /* Increased */
            background: #050505;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* --- MOBILE NAV BUTTONS --- */
        .mobile-back-btn {
            display: none; /* hidden on desktop */
            margin-right: 20px; /* Increased spacing */
            cursor: pointer;
            padding: 8px; /* Increased padding */
        }

        .mobile-home-btn {
            display: none; /* hidden on desktop */
            width: 48px; /* Increased */
            height: 48px; /* Increased */
            background: var(--gold-dim);
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            border: 1px solid var(--gold-primary);
            color: black;
            cursor: pointer;
        }

        /* --- MOBILE MODE OVERRIDES (Applied via class .is-mobile) --- */
        body.is-mobile #mobile-controls {
            display: block;
        }

        body.is-mobile .desktop-icons-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            top: 90px;
            left: 0;
            width: 100%;
            padding: 0 20px;
        }

        body.is-mobile .desktop-icon {
            width: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* Mobile Employee Table Tweaks -> Transformed to Cards */
        body.is-mobile .employee-table {
            font-size: 1rem;
            display: block;
        }
        
        body.is-mobile .employee-table thead {
            display: none; /* Hide standard headers on mobile */
        }

        body.is-mobile .employee-table tbody {
            display: block;
        }

        body.is-mobile .employee-table tr {
            display: block;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--gold-dim);
            margin-bottom: 20px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        body.is-mobile .employee-table td {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            text-align: right;
        }

        body.is-mobile .employee-table td:last-child {
            border-bottom: none;
        }

        /* Use data-label to show headers per row */
        body.is-mobile .employee-table td::before {
            content: attr(data-label);
            font-family: 'Share Tech Mono';
            color: var(--gold-dim);
            font-weight: bold;
            font-size: 0.85rem;
            text-transform: uppercase;
            margin-right: 15px;
            text-align: left;
        }

        /* Mobile Archive Header */
        body.is-mobile .archive-header {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        /* Mobile Selector Grid */
        body.is-mobile .selector-grid {
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)) !important;
        }
        body.is-mobile .variant-img-box {
            height: 140px !important;
        }

        /* Animations */
        @keyframes flicker {
            0% { opacity: 0.85; }
            25% { opacity: 0.88; }
            50% { opacity: 0.85; }
            75% { opacity: 0.87; }
            100% { opacity: 0.85; }
        }
        
        @keyframes scan {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes equalize {
            0% { height: 10%; }
            100% { height: 90%; }
        }

        @keyframes talk-pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1) rotate(5deg); }
        }

        /* --- VIEWER 3D STYLES --- */
        .viewer-stage {
            flex: 1;
            background: #000;
            border: 1px solid #333;
            position: relative;
            overflow: hidden;
            perspective: 1200px; /* Determines 3D depth */
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .viewer-stage:active {
            cursor: grabbing;
        }

        .viewer-card-wrapper {
            transform-style: preserve-3d;
            transition: transform 0.1s ease-out; /* Smooth movement */
            height: 80%; /* Base size */
            width: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            /* Ensure pointer events don't block the stage drag */
            pointer-events: none; 
        }

        #viewer-img {
            max-height: 100%;
            max-width: 100%;
            width: auto; 
            height: auto; 
            object-fit: contain; 
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            /* Give the card some thickness/backface visibility feel */
            backface-visibility: hidden;
        }

        .viewer-controls-overlay {
            position: absolute;
            bottom: 30px; /* Pushed up */
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 10;
            background: rgba(10, 10, 10, 0.85);
            padding: 12px 25px; /* Increased */
            border: 1px solid var(--gold-dim);
            border-radius: 30px;
            backdrop-filter: blur(4px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .v-btn {
            background: transparent;
            border: 1px solid #444;
            color: var(--gold-primary);
            width: 48px; height: 48px; /* Opt: Min 44px touch target */
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .v-btn:hover {
            background: var(--gold-dim);
            color: #000;
            border-color: var(--gold-primary);
        }
        
        .zoom-display {
            font-family: 'Share Tech Mono';
            font-size: 1rem; /* Increased */
            color: var(--terminal-green);
            min-width: 50px;
            text-align: center;
        }

        /* --- VIEWER SOCIAL BUTTONS --- */
        .viewer-social-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            border: 1px solid var(--gold-dim);
            color: var(--gold-primary);
            text-decoration: none;
            background: rgba(0,0,0,0.5);
            transition: all 0.2s;
            font-family: 'Share Tech Mono';
            font-size: 0.9rem;
            text-transform: uppercase;
            cursor: pointer;
        }
        .viewer-social-btn:hover {
            background: var(--gold-primary);
            color: #000;
            box-shadow: 0 0 15px var(--gold-dim);
            border-color: var(--gold-primary);
        }

        /* --- NEW: EVENT COUNTDOWN STYLES --- */
        .event-countdown {
            font-family: 'Share Tech Mono', monospace;
            font-size: 0.95rem; /* Increased */
            color: var(--glitch-blue);
            margin-top: 10px;
            padding: 6px 12px;
            background: rgba(0, 240, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.2);
            display: inline-block;
            letter-spacing: 1px;
        }
        /* --- MOBILE MODE OVERRIDES (Applied via class .is-mobile) --- */
        body.is-mobile #mobile-controls {
            display: block;
        }

        /* Typography & Touch Target Optimization for Mobile */
        body.is-mobile p, 
        body.is-mobile .brief-text-col, 
        body.is-mobile .archive-header p,
        body.is-mobile li {
            font-size: 1.05rem; /* ~19px readable base */
            line-height: 1.6; /* Improved readability */
        }

        body.is-mobile .shop-link-btn,
        body.is-mobile .assistant-btn {
            padding: 12px 24px; /* Larger hit area */
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
        }

        body.is-mobile .lang-btn {
            padding: 12px 24px; /* Larger hit area */
            margin: 5px;
        }

        body.is-mobile .desktop-icons-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            top: 90px;
            left: 0;
            width: 100%;
            padding: 0 20px;
        }

        body.is-mobile .desktop-icon {
            width: 100%;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px; /* Touch padding */
        }
        
        body.is-mobile .icon-img {
            width: 80px; height: 80px; /* Slightly smaller on mobile than desktop but bigger than before */
        }
        
        body.is-mobile .icon-label {
            font-size: 0.9rem;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 8px 12px; /* Easier to tap if needed */
        }

        /* Mobile Windows: Full Screen */
        body.is-mobile .os-window {
            width: 100% !important;
            height: calc(100% - 60px) !important; /* Minus taskbar height */
            top: 0 !important;
            left: 0 !important;
            border: none;
            border-bottom: 1px solid var(--gold-dim);
            z-index: 9999 !important; 
            box-shadow: none;
            border-radius: 0;
        }

        body.is-mobile .os-window.active {
            display: flex !important;
        }

        body.is-mobile .window-header {
            height: 60px; /* Increased for touch */
            background: #111;
            cursor: default; 
            padding: 0 15px;
        }

        body.is-mobile .win-btn {
            width: 48px; /* Min 44px touch target */
            height: 48px;
            font-size: 24px;
            margin-left: 10px;
        }

        /* Hide maximize/minimize on mobile, keep close */
        body.is-mobile .win-btn:first-child { display: none; }

        body.is-mobile .taskbar {
            z-index: 10000; 
            height: 60px; /* Increased */
            justify-content: flex-start; /* Align left to accommodate home button */
            padding-left: 15px;
        }

        body.is-mobile .start-btn {
            display: none; 
        }

        /* Show mobile nav buttons */
        body.is-mobile .mobile-home-btn {
            display: flex;
            width: 48px; height: 48px; /* 44px+ */
        }
        
        body.is-mobile .mobile-back-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold-primary);
            width: 48px; height: 48px; /* 44px+ */
            padding: 0;
        }
        
        body.is-mobile #task-list {
            flex: 1;
            overflow-x: auto;
            justify-content: flex-start;
        }
        
        body.is-mobile .task-item {
             flex: 0 0 auto;
             min-width: 100px;
             height: 48px; /* Taller touch target */
             justify-content: center;
             font-size: 1rem;
        }

        body.is-mobile #assistant-overlay {
            right: 50%;
            transform: translateX(50%);
            bottom: 70px;
            width: 90%;
            align-items: center;
        }
        
        body.is-mobile .login-box {
            width: 95%;
            padding: 30px;
        }
    </style>
</head>
<body id="main-body">

    <div class="crt-overlay"></div>
    <div class="vignette"></div>

    <!-- Mobile Rotate Button -->
    <div id="mobile-controls">
        <button class="mobile-btn" onclick="System.toggleRotation()">
            <i data-lucide="rotate-cw"></i> <span data-i18n="btn_rotate">ROTATE</span>
        </button>
    </div>

    <!-- WRAPPER FOR ROTATION -->
    <div id="app-container">

        <!-- LOGIN SCREEN -->
        <div id="login-screen">
            <!-- Mode Switcher on Login -->
            <div style="position: absolute; top: 20px; right: 20px;">
                <button class="mode-switch-btn" onclick="System.toggleMode()">
                    <!-- Content populated by JS -->
                    [UI_MODE_LOADING]
                </button>
            </div>

            <!-- Title Moved Outside Box -->
            <h1 class="login-title">DISTORTION CORP</h1>

            <div class="login-box">
                
                <div class="lang-selector">
                    <button class="lang-btn active" onmouseenter="AudioManager.play('hover')" onclick="System.setLanguage('en'); AudioManager.play('click')">EN</button>
                    <button class="lang-btn" onmouseenter="AudioManager.play('hover')" onclick="System.setLanguage('ko'); AudioManager.play('click')">한국어</button>
                    <button class="lang-btn" onmouseenter="AudioManager.play('hover')" onclick="System.setLanguage('ja'); AudioManager.play('click')">日本語</button>
                </div>

                <p data-i18n="login_sub" style="font-size: 1rem; color: #888; margin-bottom: 20px; font-family: 'Share Tech Mono'; letter-spacing: 2px;">SECURE ACCESS TERMINAL v9.4</p>
                
                <!-- NEW LOGIN INPUT BAR -->
                <div class="login-input-wrapper" id="login-wrapper">
                    <div class="login-input-container">
                        <span class="input-prefix">></span>
                        <input type="text" id="login-input" class="login-input" placeholder="ENTER_ACCESS_CODE..." autocomplete="off" spellcheck="false">
                        <button class="login-submit-btn" onclick="System.login()">
                            <i data-lucide="arrow-right" width="24"></i>
                        </button>
                    </div>
                </div>

                <div id="login-message" class="login-msg">VERIFYING CREDENTIALS...</div>
            </div>
        </div>

        <!-- DESKTOP SCREEN -->
        <div id="desktop-screen">
            
            <!-- OS Top Bar -->
            <div class="os-bar">
                <div style="display: flex; align-items: center;">
                    <div data-i18n="os_connected" style="margin-right: 20px;">DISTORTION_OS // CONNECTED</div>
                    <button class="mode-switch-btn" onclick="System.toggleMode()">
                        <!-- Content populated by JS -->
                        [UI_MODE]
                    </button>
                </div>
                
                <!-- Only Clock remains in Top Right -->
                <div class="top-right-group">
                    <div id="clock">00:00:00</div>
                </div>
            </div>

            <!-- Desktop Icons (Cleaned HTML, listeners added via JS) -->
            <div class="desktop-icons-container">
                <div class="desktop-icon" data-window="win-overview" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="file-text" width="64" height="64"></i></div>
                    <div data-i18n="icon_overview" class="icon-label">PROJECT_BRIEF.LOG</div>
                </div>

                <div class="desktop-icon" data-window="win-archive" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="database" width="64" height="64"></i></div>
                    <div data-i18n="icon_archive" class="icon-label">FIRST LIGHT: ARCHIVE_DB.EXE</div>
                </div>
                
                <div class="desktop-icon" data-window="win-employees" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="users" width="64" height="64"></i></div>
                    <div data-i18n="icon_employees" class="icon-label">EMPLOYEE_DB.EXE</div>
                </div>

                <div class="desktop-icon" data-window="win-shop" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="calendar" width="64" height="64"></i></div>
                    <div data-i18n="icon_shop" class="icon-label">EVENT_LOG.TXT</div>
                </div>

                <div class="desktop-icon" data-window="win-comm" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="radio" width="64" height="64"></i></div>
                    <div data-i18n="icon_comm" class="icon-label">COMMUNICATION.EXE</div>
                </div>

                <div class="desktop-icon" data-window="win-tos" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="file-check" width="64" height="64"></i></div>
                    <div data-i18n="icon_tos" class="icon-label">TERMS_OF_SERVICE.TXT</div>
                </div>

                <div class="desktop-icon" data-window="win-audio" tabindex="0" role="button">
                    <div class="icon-img"><i data-lucide="music" width="64" height="64"></i></div>
                    <div class="icon-label">AUDIO_01.EXE</div>
                </div>
            </div>

            <!-- WINDOW: OVERVIEW -->
            <div id="win-overview" class="os-window" style="top: 10%; left: 15%; width: 950px; height: 650px;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-overview')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span data-i18n="win_overview" class="win-title">PROJECT_BRIEF.LOG</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-overview')"><i data-lucide="minus" width="14"></i></div>
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-overview')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-overview')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    
                    <div class="brief-meta">
                        <span>ID: 001-GENESIS-DIVINA</span>
                        <span>CLEARANCE: PUBLIC</span>
                    </div>

                    <div class="brief-layout">
                        <!-- Left Column: Text -->
                        <div class="brief-text-col">
                            <h1 data-i18n="overview_title" style="font-family: 'Cinzel'; font-size: 2.5rem; margin-bottom: 25px; color: var(--gold-primary); text-shadow: 0 0 10px rgba(212,175,55,0.2);">DISTORTION DIVINA</h1>
                            <p data-i18n="overview_text_1" style="margin-bottom: 25px; line-height: 1.6; color: #ccc; font-size: 1.1rem;">
                                Distortion Divina is an unofficial fan project inspired by the worlds of Project Moon and Project Mili. Our dream is to build a collectible, tarot-inspired card game- created by fans, for fans.
                            </p>
                            <p data-i18n="overview_text_2" style="line-height: 1.6; color: #aaa; font-size: 1.1rem;">
                                We are building this vision in phases. Our first chapter, First Light, is dedicated to proving our creative process. Our priority right now is simply to deliver stunning, high-quality illustrations that pay proper homage to the source material.<br><br>This is a passion project currently running on personal funds. Every penny of profit goes directly to our amazing artists and brings us one step closer to the full game. We hope you'll join us on this journey.
                            </p>
                        </div>

                        <!-- Right Column: Image Area -->
                        <div class="brief-visual-col">
                            <div class="brief-frame">
                                <img src="https://media.discordapp.net/attachments/1457280504758800384/1457280757872459963/misson.jpg?ex=695b6df7&is=695a1c77&hm=4ca2f3c4a299c4607120c3c00de3ad1000d135339039ca9bdc62011a9cdfee2a&=&format=webp&width=2645&height=1869" class="brief-img" alt="Project Visual" onerror="this.style.display='none'">
                                <div class="brief-caption">FIG_A: CONCEPT_VISUALIZATION</div>
                            </div>
                            
                            <div style="margin-top: 20px; border: 1px dashed #333; padding: 15px; font-size: 0.85rem; color: #666;">
                                <div style="color: var(--terminal-green); margin-bottom: 8px;">> SYSTEM NOTES:</div>
                                The "First Light" initiative is currently active. All personnel are advised to review the Archive DB for drop rates.
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- WINDOW: ARCHIVE -->
            <div id="win-archive" class="os-window" style="top: 5%; left: 35%; width: 900px; height: 700px;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-archive')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span data-i18n="win_archive" class="win-title">FIRST LIGHT: ARCHIVE_DB.EXE</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-archive')"><i data-lucide="minus" width="14"></i></div>
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-archive')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-archive')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="archive-header">
                        <div class="archive-header-img">
                            <img src="https://media.discordapp.net/attachments/1457280504758800384/1457290787942568110/background.png?ex=695b774e&is=695a25ce&hm=3cb1d8a77e954f6f037aa56cbc37d93bfa8f96b09f6ec4ae1d5b1079a837f35a&=&format=webp&quality=lossless&width=621&height=887" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src='https://placehold.co/200x300/000/333?text=Error'">
                        </div>
                        <div class="archive-header-text">
                            <h2>FIRST LIGHT</h2>
                            <p>The initial manifestation. A collection of archetypes emerging from the distortion. Witness the beginning of the reconstruction.</p>
                            
                            <div class="rates-dashboard">
                                <div class="rates-section">
                                    <div class="rates-section-title" data-i18n="rates_title">PACK CONFIGURATION</div>
                                    <div class="pack-config">
                                        <div class="config-badge holo">
                                            <i data-lucide="sparkles" width="18"></i> <span data-i18n="rates_content_holo">1x HOLOGRAPHIC</span>
                                        </div>
                                        <div class="config-badge norm">
                                            <i data-lucide="layers" width="18"></i> <span data-i18n="rates_content_norm">4x NORMAL</span>
                                        </div>
                                    </div>
                                    <div style="font-size: 0.9rem; color: #666; margin-top: 8px;" data-i18n="rates_total_count">Total: 9 Holo / 29 Normal</div>
                                </div>

                                <div class="rates-section">
                                    <div class="rates-section-title" data-i18n="rates_drop_title">DROP RATES (PER SLOT)</div>
                                    <div class="rates-grid">
                                        <div class="rate-card holo">
                                            <span class="rate-label" data-i18n="rates_holo_label">SPECIFIC HOLO</span>
                                            <span class="rate-value">11.1%</span>
                                            <span class="rate-sub">1 / 9</span>
                                        </div>
                                        <div class="rate-card norm">
                                            <span class="rate-label" data-i18n="rates_norm_label">SPECIFIC NORMAL</span>
                                            <span class="rate-value">3.57%</span>
                                            <span class="rate-sub">1 / 29</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- NEW DISTRIBUTION NOTICE -->
                                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px dashed rgba(212, 175, 55, 0.3); font-size: 0.9rem; color: #aaa; line-height: 1.4;">
                                    <span style="color: var(--terminal-green); font-weight: bold;">>> DISTRIBUTION PROTOCOL:</span>
                                    First Light is distributed in sealed packs of 5 cards (4 Normal, 1 Holographic). Contents are randomized by the system; individual selection is not permitted. May the luck of the draw be with you.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px; font-size: 1rem; color: #666;">
                        <span data-i18n="archive_status">> LOADING ASSETS... COMPLETE</span>
                    </div>
                    <div class="archive-grid" id="cardGrid"></div>
                </div>
            </div>
            
            <!-- WINDOW: VARIANT SELECTOR -->
            <div id="win-selector" class="os-window" style="display: none; top: 10%; left: 15%; width: 1000px; height: 800px; z-index: 2001;">
                <div class="window-header" style="background: linear-gradient(90deg, #1a1a1a, #000); border-bottom: 1px solid var(--gold-primary);">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-selector')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span class="win-title" style="color: var(--gold-primary);">VARIANT_SELECTOR.EXE</span>
                    </div>
                    <div class="win-controls">
                        <!-- Selector is modal-like, usually fixed size, but we can add maximize if desired. Let's keep it close-only for modal feel, or add it. Added for consistency. -->
                        <div class="win-btn" onclick="WindowManager.toggleMaximize('win-selector')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-selector')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <h2 id="selector-title" style="font-family: 'Cinzel'; color: white; margin-bottom: 10px; font-size: 2rem;">SELECT VARIANT</h2>
                    <p style="color: #888; font-size: 1rem; margin-bottom: 25px;">Multiple data streams detected. Select a timeline to view.</p>
                    <div id="selector-grid" class="selector-grid"></div>
                </div>
                <style>
                    .selector-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Increased from 260 */
                        gap: 30px; /* Increased gap */
                    }
                    .variant-card {
                        border: 1px solid #333;
                        background: rgba(255, 255, 255, 0.02);
                        cursor: pointer;
                        transition: all 0.2s;
                        display: flex;
                        flex-direction: column;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
                    }
                    .variant-card:hover {
                        border-color: var(--gold-primary);
                        background: rgba(212, 175, 55, 0.1);
                        transform: translateY(-5px); 
                        box-shadow: 0 10px 20px rgba(0,0,0,0.5);
                    }
                    .variant-img-box {
                        height: 450px; /* Increased from 380 */
                        background: #000;
                        overflow: hidden;
                        border-bottom: 1px solid #333;
                    }
                    .variant-img-box img {
                        width: 100%; 
                        height: 100%; 
                        object-fit: cover; 
                        opacity: 0.8;
                        transition: opacity 0.3s;
                    }
                    .variant-card:hover .variant-img-box img { opacity: 1; }
                    .variant-info {
                        padding: 20px; /* Increased */
                    }
                    .variant-char {
                        color: var(--terminal-green);
                        font-weight: bold;
                        font-size: 1.4rem; /* Larger font */
                        margin-bottom: 6px;
                        font-family: 'Cinzel', serif;
                    }
                    .variant-artist {
                        color: #aaa;
                        font-size: 1rem;
                        font-family: 'Share Tech Mono', monospace;
                    }
                </style>
            </div>
            
            <!-- WINDOW: EMPLOYEES -->
            <div id="win-employees" class="os-window" style="top: 8%; left: 15%; width: 850px; height: 600px;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-employees')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span data-i18n="win_employees" class="win-title">EMPLOYEE_DB.EXE</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-employees')"><i data-lucide="minus" width="14"></i></div>
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-employees')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-employees')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <div style="margin-bottom: 25px; border-bottom: 1px solid var(--gold-dim); padding-bottom: 15px;">
                        <h2 data-i18n="employees_header" style="font-family: 'Cinzel'; margin-bottom: 10px; font-size: 2rem;">PERSONNEL DATABASE</h2>
                        <div style="font-size: 1rem; color: var(--terminal-green);"><span data-i18n="emp_accessing">> ACCESSING TEAM RECORDS...</span></div>
                    </div>
                    
                    <div style="overflow-x: auto;">
                        <table class="employee-table">
                            <thead>
                                <tr>
                                    <th data-i18n="th_no">NO.</th>
                                    <th data-i18n="th_card">CARD</th>
                                    <th data-i18n="th_char">CHARACTER</th>
                                    <th data-i18n="th_emp">EMPLOYEES</th>
                                    <th data-i18n="th_pen">PEN NAME</th>
                                    <th data-i18n="th_role">ROLE</th>
                                </tr>
                            </thead>
                            <tbody id="employee-list-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- WINDOW: SHOP / EVENTS -->
            <div id="win-shop" class="os-window" style="top: 15%; left: 25%; width: 700px; height: 600px;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-shop')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span data-i18n="icon_shop" class="win-title">EVENT_LOG.TXT</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-shop')"><i data-lucide="minus" width="14"></i></div>
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-shop')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-shop')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <h2 data-i18n="shop_header" style="font-family: 'Cinzel'; margin-bottom: 25px; font-size: 2rem;">UPCOMING EVENTS</h2>
                    
                    <!-- Event 1: Lunatic Moonlight (Updated Layout) -->
                    <div class="shop-item" style="display: flex; gap: 25px; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h3 data-i18n="event_1_title" style="color: #fff; font-size: 1.5rem;">LUNATIC MOONLIGHT EVENT</h3>
                            
                            <div style="margin: 15px 0; font-size: 1rem; color: #aaa; border-left: 2px solid var(--gold-dim); padding-left: 15px;">
                                <p data-i18n="event_1_loc" style="margin-bottom: 6px;">LOCATION: TOKYO</p>
                                <p style="color: var(--terminal-green); font-weight: bold; margin-bottom: 6px;">BOOTH: A14 (DISTORTION CORP)</p>
                                <p style="color: #ccc;">TIME: 11:30 - 16:00</p>
                            </div>

                            <!-- COUNTDOWN 1 -->
                            <div id="countdown-1" class="event-countdown">CALCULATING T-MINUS...</div>

                            <div data-i18n="event_1_date" style="font-size: 1.4rem; color: var(--gold-primary); margin-top: 15px;">15 FEB 2026</div>
                            <a href="https://lunaticmoonight.jimdosite.com" target="_blank" class="shop-link-btn" data-i18n="btn_visit">[ VISIT LINK ]</a>
                        </div>
                        
                        <!-- Event Image Section -->
                        <div style="flex: 0 0 140px; border: 1px solid var(--gold-dim); height: 140px; background: #000;">
                            <img src="https://placehold.co/200x200/1a1a1a/D4AF37?text=EVENT" style="width: 100%; height: 100%; object-fit: cover;" alt="Event Visual">
                        </div>
                    </div>

                    <!-- Event 2: One Million Moon (Updated Layout) -->
                    <div class="shop-item" style="display: flex; gap: 25px; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h3 data-i18n="event_2_title" style="color: #fff; font-size: 1.5rem;">ONE MILLION MOON CONCERT</h3>
                            <p data-i18n="event_2_loc" style="color: #888; font-size: 1rem; margin: 10px 0;">LOCATION: JAPAN</p>
                            
                            <!-- COUNTDOWN 2 -->
                            <div id="countdown-2" class="event-countdown" style="margin-bottom: 12px;">CALCULATING T-MINUS...</div>

                            <div data-i18n="event_2_date" style="font-size: 1.4rem; color: var(--gold-primary); margin-top: 8px;">21 FEB 2026</div>
                            <a href="https://global.onemillionmoons.kr" target="_blank" class="shop-link-btn" data-i18n="btn_visit">[ VISIT LINK ]</a>
                        </div>

                        <!-- Event Image Section -->
                        <div style="flex: 0 0 140px; border: 1px solid var(--gold-dim); height: 140px; background: #000;">
                            <img src="https://placehold.co/200x200/0a0a0a/33ff00?text=OMM" style="width: 100%; height: 100%; object-fit: cover;" alt="Event Visual">
                        </div>
                    </div>

                    <!-- Event 3 -->
                    <div class="shop-item" style="border-color: var(--gold-primary); background: rgba(212,175,55,0.05);">
                        <h3 data-i18n="event_3_title" style="color: #fff; font-size: 1.5rem;">ONLINE STORE OPENING</h3>
                        <p data-i18n="event_3_desc" style="color: var(--terminal-green); font-size: 1.1rem; margin: 15px 0;">STATUS: COMING SOON</p>
                    </div>
                </div>
            </div>

            <!-- WINDOW: COMMUNICATION -->
            <div id="win-comm" class="os-window" style="top: 20%; left: 30%; width: 450px; height: 400px;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-comm')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span data-i18n="win_comm" class="win-title">COMMUNICATION.EXE</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-comm')"><i data-lucide="minus" width="14"></i></div>
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-comm')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-comm')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <h2 data-i18n="comm_header" style="font-family: 'Cinzel'; margin-bottom: 25px; font-size: 2rem;">SECURE UPLINKS</h2>
                    
                    <!-- Twitter -->
                    <div class="shop-item">
                        <h3 data-i18n="comm_twitter" style="color: #fff; display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="twitter" width="24" height="24"></i> TWITTER // X
                        </h3>
                        <p style="color: #888; font-size: 1rem; margin: 8px 0;">> ENCRYPTED FEED ESTABLISHED</p>
                        <a href="https://x.com/DistortDivina" target="_blank" class="shop-link-btn" data-i18n="btn_visit">[ VISIT LINK ]</a>
                    </div>

                    <!-- Discord -->
                    <div class="shop-item">
                        <h3 data-i18n="comm_discord" style="color: #fff; display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="message-circle" width="24" height="24"></i> DISCORD SERVER
                        </h3>
                        <p style="color: #888; font-size: 1rem; margin: 8px 0;">> SECURE CHANNEL OPEN</p>
                        <a href="https://discord.gg/GNb5HcMddP" target="_blank" class="shop-link-btn" data-i18n="btn_visit">[ VISIT LINK ]</a>
                    </div>

                    <!-- Email -->
                    <div class="shop-item">
                        <h3 data-i18n="comm_email" style="color: #fff; display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="mail" width="24" height="24"></i> EMAIL UPLINK
                        </h3>
                        <p style="color: #888; font-size: 1rem; margin: 8px 0;">> DIRECT FREQUENCY OPEN</p>
                        <a href="mailto:divinadistortion@gmail.com" class="shop-link-btn" data-i18n="btn_email">[ SEND TRANSMISSION ]</a>
                        
                        <!-- Manual Copy Fallback -->
                        <div style="margin-top: 15px; background: rgba(0,0,0,0.6); padding: 10px; border: 1px dashed var(--gold-dim); display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="at-sign" width="16" color="var(--terminal-green)"></i>
                            <span style="color: var(--terminal-green); font-family: 'Share Tech Mono'; user-select: text; -webkit-user-select: text;">divinadistortion@gmail.com</span>
                        </div>
                    </div>

                    <!-- Admin Personal -->
                    <div class="shop-item">
                        <h3 data-i18n="comm_admin" style="color: #fff; display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="shield" width="24" height="24"></i> ADMIN DIRECT LINE
                        </h3>
                        <p style="color: #888; font-size: 1rem; margin: 8px 0;">> OVERSEER: oober</p>
                        <p style="color: #aaa; font-size: 0.9rem; margin-bottom: 12px; font-style: italic;">"Feel free to add and ask me any questions."</p>
                        <div style="background: rgba(0,0,0,0.6); padding: 10px; border: 1px dashed var(--gold-dim); display: flex; align-items: center; gap: 10px;">
                            <i data-lucide="user" width="16" color="var(--terminal-green)"></i>
                            <span style="color: var(--terminal-green); font-family: 'Share Tech Mono';">DISCORD ID: oober</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WINDOW: TOS -->
            <div id="win-tos" class="os-window" style="top: 25%; left: 35%; width: 600px; height: 500px;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-tos')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span data-i18n="win_tos" class="win-title">TERMS_OF_SERVICE.TXT</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-tos')"><i data-lucide="minus" width="14"></i></div>
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-tos')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-tos')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <h2 data-i18n="tos_header" style="font-family: 'Cinzel'; margin-bottom: 25px; font-size: 2rem;">TERMS OF SERVICE</h2>
                    <p data-i18n="tos_content" style="line-height: 1.6; color: #aaa; margin-bottom: 35px; font-size: 1.1rem;">
                        Distortion Divina is an unofficial fan project inspired by the worlds of Project Moon and Project Mili. All rights belong to the individual owners and artists.
                    </p>
                    
                    <div style="border-top: 1px solid var(--gold-dim); padding-top: 25px;">
                        <h3 data-i18n="tos_guidelines_header" style="color: #fff; font-size: 1.1rem; margin-bottom: 20px;">OFFICIAL GUIDELINES</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <p style="color: #888; font-size: 1rem; margin-bottom: 8px;">PROJECT MOON</p>
                            <a href="https://x.com/ProjMoonStudio/status/1629085462236397573?lang=en" target="_blank" class="shop-link-btn" data-i18n="btn_visit">[ VIEW GUIDELINES ]</a>
                        </div>

                        <div>
                            <p style="color: #888; font-size: 1rem; margin-bottom: 8px;">PROJECT MILI</p>
                            <a href="https://projectmili.com/copyright-guidelines" target="_blank" class="shop-link-btn" data-i18n="btn_visit">[ VIEW GUIDELINES ]</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WINDOW: AUDIO PLAYER -->
            <div id="win-audio" class="os-window" style="bottom: 80px; right: 20px; width: 350px; height: 300px; display: none;">
                <div class="window-header">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-audio')"><i data-lucide="arrow-left" width="36" height="36"></i></div>
                        <span class="win-title">AUDIO_01.EXE</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" aria-label="Minimize" onclick="WindowManager.minimize('win-audio')"><i data-lucide="minus" width="14"></i></div>
                        <!-- Audio player usually fixed size, but we can enable maximize for visualizer fun -->
                        <div class="win-btn" aria-label="Maximize" onclick="WindowManager.toggleMaximize('win-audio')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" aria-label="Close" onclick="WindowManager.close('win-audio')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content" style="display: flex; flex-direction: column; justify-content: space-between;">
                    
                    <div class="track-info" id="audio-track-name" data-i18n="audio_no_disc">NO DISC INSERTED</div>
                    
                    <div class="visualizer-container" id="visualizer">
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        <div class="bar"></div><div class="bar"></div>
                    </div>

                    <div class="player-controls">
                        <button class="ctrl-btn" onclick="AudioManager.prev()"><i data-lucide="skip-back" width="20"></i></button>
                        <button class="ctrl-btn" onclick="AudioManager.toggle()"><i id="play-icon" data-lucide="play" width="20"></i></button>
                        <button class="ctrl-btn" onclick="AudioManager.next()"><i data-lucide="skip-forward" width="20"></i></button>
                    </div>
                </div>
            </div>

            <!-- WINDOW: VIEWER -->
            <div id="win-viewer" class="os-window" style="display: none; top: 5%; left: 10%; width: 85%; height: 85%; z-index: 2000;">
                <div class="window-header" style="background: var(--gold-dim); color: black;">
                    <div style="display: flex; align-items: center;">
                        <div class="mobile-back-btn" onclick="WindowManager.close('win-viewer')"><i data-lucide="arrow-left" width="36" height="36" color="black"></i></div>
                        <span data-i18n="viewer_title" class="win-title" style="color:black">ARTIFACT_VIEWER.EXE</span>
                    </div>
                    <div class="win-controls">
                        <div class="win-btn" style="border-color: black; color: black;" onclick="WindowManager.toggleMaximize('win-viewer')"><i data-lucide="maximize" width="14"></i></div>
                        <div class="win-btn close" style="border-color: black; color: black;" aria-label="Close" onclick="WindowManager.close('win-viewer')"><i data-lucide="x" width="14"></i></div>
                    </div>
                </div>
                <div class="window-content">
                    <div class="viewer-layout" style="display:flex; flex-direction:column; height:100%; gap:30px;">
                        
                        <!-- 3D STAGE CONTAINER -->
                        <div class="viewer-stage" id="viewer-stage">
                            <div id="viewer-loader" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); color:var(--terminal-green); display:none; font-size: 1.5rem;">LOADING...</div>
                            
                            <!-- Wrapper for 3D Transforms -->
                            <div class="viewer-card-wrapper" id="viewer-card-wrapper">
                                <img id="viewer-img" src="" onerror="this.src='https://placehold.co/400x600/000/333?text=ASSET+MISSING'">
                            </div>

                            <!-- Floating Controls -->
                            <div class="viewer-controls-overlay">
                                <button class="v-btn" onclick="Viewer3D.adjustZoom(-0.2)" title="Zoom Out"><i data-lucide="minus" width="20"></i></button>
                                <span class="zoom-display" id="zoom-val">100%</span>
                                <button class="v-btn" onclick="Viewer3D.adjustZoom(0.2)" title="Zoom In"><i data-lucide="plus" width="20"></i></button>
                                <div style="width: 1px; height: 24px; background: #444; margin: 0 10px;"></div>
                                <button class="v-btn" onclick="Viewer3D.reset()" title="Reset View"><i data-lucide="refresh-cw" width="20"></i></button>
                            </div>
                        </div>

                        <div class="viewer-info" style="flex:1;">
                            <div style="border-bottom: 1px solid var(--gold-dim); padding-bottom: 15px; margin-bottom: 25px;">
                                <div style="font-size: 0.9rem; color: #666;"><span data-i18n="viewer_asset_id">ID:</span> <span id="viewer-id"></span></div>
                                <h2 id="viewer-title" style="font-family: 'Cinzel'; font-size: 2.5rem; color: var(--gold-primary);"></h2>
                            </div>
                            <p id="viewer-desc" style="line-height: 1.6; color: #ccc; margin-bottom: 35px; font-size: 1.2rem;"></p>
                            <div style="background: rgba(255,255,255,0.05); padding: 20px;">
                                <h3 data-i18n="viewer_artist_label" style="font-size: 1rem; color: #888; margin-bottom: 15px;">ARTIST DATA</h3>
                                <div id="viewer-artist" style="font-size: 1.4rem; margin-bottom: 15px; color: white;"></div>
                                <div id="viewer-socials" style="display: flex; gap: 15px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <style>@media(min-width: 768px){ #win-viewer .viewer-layout { flex-direction: row !important; } }</style>
            </div>

            <!-- ASSISTANT OVERLAY -->
            <div id="assistant-overlay">
                <div class="assistant-bubble">
                    <span id="assistant-text">Welcome, Agent. I am OOB. I can guide you through the archive.</span>
                    <div class="assistant-controls">
                        <button class="assistant-btn" onclick="System.nextAssistantStep()">NEXT ></button>
                        <button class="assistant-btn" onclick="System.closeAssistant()">DISMISS [X]</button>
                    </div>
                </div>
                <div class="assistant-avatar">
                    <i data-lucide="cat" width="48" height="48" color="#D4AF37"></i>
                </div>
            </div>

            <!-- TASKBAR -->
            <div class="taskbar">
                <!-- Mobile Home Button -->
                <div class="mobile-home-btn" onclick="WindowManager.showDesktop()">
                    <i data-lucide="grid" width="24"></i>
                </div>
                
                <div class="start-btn" onmouseenter="AudioManager.play('hover')" onclick="AudioManager.play('click')">
                    <i data-lucide="power" width="20" height="20" style="margin-right: 8px;"></i> <span data-i18n="btn_system">SYSTEM</span>
                </div>
                <div id="task-list" style="display:flex;"></div>

                <!-- SIGNAL WIDGET (Moved to Bottom Right) -->
                <div class="signal-widget">
                    <!-- Bars -->
                    <div class="signal-graph">
                        <div class="sig-bar"></div>
                        <div class="sig-bar"></div>
                        <div class="sig-bar"></div>
                        <div class="sig-bar"></div>
                    </div>
                    
                    <!-- Data Text -->
                    <div class="signal-data" style="display: none; @media(min-width:768px){display:flex;}"> <!-- Hidden on very small screens -->
                        <div class="sig-label">HASH</div>
                        <div class="enc-hash" id="enc-hash-display">A7F2-9X00</div>
                    </div>

                    <!-- Latency Text -->
                    <div class="signal-data">
                        <div class="sig-label">PING</div>
                        <div class="sig-value" id="sig-latency">34ms</div>
                    </div>
                    
                    <!-- Lock Icon -->
                    <i data-lucide="lock" width="16" height="16" color="#444"></i>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 1. DATA REPOSITORY (Namespace: DB) ---
        const DB = {
            CARDS: [
                { id: 0, title: { en: "0. The Fool", ko: "0. 바보", ja: "0. 愚者" }, artist: "Herokatz", description: { en: "New beginnings.", ko: "새로운 시작.", ja: "新しい始まり。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291783980453950/thefool.png?ex=695b783c&is=695a26bc&hm=001bcaf51a19d113300f0bb96f8642f6cb81c3aa3681c1295b8a822d09e74ebd&=&format=webp&quality=lossless&width=623&height=887", socials: { twitter: "#" } },
                { id: 1, title: { en: "I. The Magician", ko: "I. 마법사", ja: "I. 魔術師" }, artist: "Violetta", description: { en: "Manifestation.", ko: "구현.", ja: "顕現。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291820089217129/themagician.png?ex=695b7845&is=695a26c5&hm=b005def9f5af1d209d9622696a316e492597370710ba8d5a927f40635bdafe47&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "#" } },
                { id: 2, title: { en: "II. High Priestess", ko: "II. 여사제", ja: "II. 女教皇" }, artist: "Sinn/Square", description: { en: "Intuition.", ko: "직관.", ja: "直感。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291800124326143/thehighpriestess.png?ex=695b7840&is=695a26c0&hm=0e6c3342ab9256b509bafffd93a2220e210eba589e73fce583565c4b3c4b9fe8&=&format=webp&quality=lossless&width=621&height=888", socials: { website: "#" } },
                // PARENT: EMPRESS
                { id: 3, title: { en: "III. The Empress", ko: "III. 여황제", ja: "III. 女帝" }, artist: "Various", description: { en: "Nature.", ko: "자연.", ja: "自然。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291756134732000/theempress.png?ex=695b7835&is=695a26b5&hm=dea355082beb675c1157967f338ebde79a50667f738f9b1432ca98ffef5d8633&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "#" } },
                { id: 4, title: { en: "IV. The Emperor", ko: "IV. 황제", ja: "IV. 皇帝" }, artist: "Sierra", description: { en: "Authority.", ko: "권위.", ja: "権威。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291749406801951/theemperor.png?ex=695b7834&is=695a26b4&hm=f718477ad5b8c96821b37b4537ece57a3668b13623aeced4eca930e243c02457&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "#" } },
                { id: 5, title: { en: "V. The Hierophant", ko: "V. 교황", ja: "V. 法王" }, artist: "Vel", description: { en: "Tradition.", ko: "전통.", ja: "伝統。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291790913900778/thehierophant.png?ex=695b783e&is=695a26be&hm=483e669d9d2bd88adefbc6a4969dc6986d47c7f46555b734cab36c04946a5955&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "#" } },
                { id: 6, title: { en: "VI. The Lovers", ko: "VI. 연인", ja: "VI. 恋人" }, artist: "33", description: { en: "Love.", ko: "사랑.", ja: "愛。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291809041547407/thelovers.png?ex=695b7842&is=695a26c2&hm=f2885a553bda976d93b8bf681a0c24a5596088b03cb50808327999263c13bb28&=&format=webp&quality=lossless&width=621&height=887", socials: { website: "#" } },
                { id: 7, title: { en: "VII. The Chariot", ko: "VII. 전차", ja: "VII. 戦車" }, artist: "Moozy", description: { en: "Willpower.", ko: "의지.", ja: "意志。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291726241792144/thechariot.png?ex=695b782e&is=695a26ae&hm=acfd8f9edae193535598289690bc1972de00f1a7c3994601fe56d309ae7437c1&=&format=webp&quality=lossless&width=621&height=887", socials: { instagram: "#" } },
                { id: 8, title: { en: "VIII. Strength", ko: "VIII. 힘", ja: "VIII. 力" }, artist: "Steph", description: { en: "Strength.", ko: "힘.", ja: "力。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291651352367165/strength.png?ex=695b781c&is=695a269c&hm=e752c2b4a42892763cb82290c9ecaaf9af51a816c2ac5f856e4cb194f90069b7&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "#" } },
                { id: 9, title: { en: "IX. The Hermit", ko: "IX. 은둔자", ja: "IX. 隠者" }, artist: "Karrii", description: { en: "Soul-searching.", ko: "자아 성찰.", ja: "自己探求。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291716498427985/the_hermit.png?ex=695b782c&is=695a26ac&hm=e25ab6e918f2f2e6e1902b8353b8d4aa3b31026f2fffc4069c25c2f711952184&=&format=webp&quality=lossless&width=623&height=888", socials: { website: "#" } },
                { id: 10, title: { en: "X. Wheel of Fortune", ko: "X. 운명의 수레바퀴", ja: "X. 運命の輪" }, artist: "Victor", description: { en: "Destiny.", ko: "운명.", ja: "運命。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291897709264999/wheeloffortune.png?ex=695b7857&is=695a26d7&hm=5d489da6ba134349dc24a589de15dbd776070b5d435be86335bd4c3f3bfe20b7&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "#" } },
                { id: 11, title: { en: "XI. Justice", ko: "XI. 정의", ja: "XI. 正義" }, artist: "Ruri", description: { en: "Fairness.", ko: "공정.", ja: "公正。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291642938851504/justice.png?ex=695b781a&is=695a269a&hm=40bb52d3802408a42a2bc9545aa3d03ffdefeb406b288c17ee1ce0f0f3e06ccf&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "#" } },
                { id: 12, title: { en: "XII. Hanged Man", ko: "XII. 매달린 사람", ja: "XII. 吊るされた男" }, artist: "Muta", description: { en: "Surrender.", ko: "항복.", ja: "降伏。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291787122249834/thehangingman.png?ex=695b783d&is=695a26bd&hm=6bb06a21e30bda7799f76151507dc5b3d03022e3efedcb87caea02537bc0c29d&=&format=webp&quality=lossless&width=369&height=525", socials: { twitter: "#" } },
                { id: 13, title: { en: "XIII. Death", ko: "XIII. 죽음", ja: "XIII. 死神" }, artist: "Various", description: { en: "Transformation.", ko: "변형.", ja: "変容。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291592627912725/death.png?ex=695b780e&is=695a268e&hm=0918fe520d72796a0f6ab998f7627b5651a8f01a77ad64037354e618b8f370e7&=&format=webp&quality=lossless&width=621&height=887", socials: { website: "#" } },
                { id: 14, title: { en: "XIV. Temperance", ko: "XIV. 절제", ja: "XIV. 節制" }, artist: "Kali", description: { en: "Balance.", ko: "균형.", ja: "バランス。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291701071904921/temperance.png?ex=695b7828&is=695a26a8&hm=eab4d05f0a9038a9c0a1f80feb8abed10d5467752cea1f206f9c29f7e4ad8921&=&format=webp&quality=lossless&width=623&height=887", socials: { instagram: "#" } },
                { id: 15, title: { en: "XV. The Devil", ko: "XV. 악마", ja: "XV. 悪魔" }, artist: "oob", description: { en: "Addiction.", ko: "중독.", ja: "中毒。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291738660999270/thedevil.png?ex=695b7831&is=695a26b1&hm=a594536ea612504133ff0da8ba1e60f371c724bbb0faa857cd16598fc704cb80&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "#" } },
                // PARENT: TOWER
                { id: 16, title: { en: "XVI. The Tower", ko: "XVI. 탑", ja: "XVI. 塔" }, artist: "Various", description: { en: "Chaos.", ko: "혼돈.", ja: "混沌。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291865241030881/thetower.png?ex=695b784f&is=695a26cf&hm=75515b87aab92e64d76b202c6ce61884baf4b8947e16bb93a30baf9bbd76e7cc&=&format=webp&quality=lossless&width=621&height=888", socials: { website: "#" } },
                { id: 17, title: { en: "XVII. The Star", ko: "XVII. 별", ja: "XVII. 星" }, artist: "Wenli", description: { en: "Hope.", ko: "희망.", ja: "希望。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291847507644416/thestar.png?ex=695b784b&is=695a26cb&hm=2aefbbe0ee3080d01261d2129d6350f9e91e03317ea1d41070fe3c02f6fb47a4&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "#" } },
                { id: 18, title: { en: "XVIII. The Moon", ko: "XVIII. 달", ja: "XVIII. 月" }, artist: "Laser", description: { en: "Illusion.", ko: "환상.", ja: "幻想。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291828171640958/themoon.png?ex=695b7847&is=695a26c7&hm=80e9554561c3d45d8fdabb3b6070d891c3b85a55780e60db40602a702f691c6f&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "#" } },
                { id: 19, title: { en: "XIX. The Sun", ko: "XIX. 태양", ja: "XIX. 太陽" }, artist: "Accio", description: { en: "Success.", ko: "성공.", ja: "成功。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291855598325843/thesun.png?ex=695b784d&is=695a26cd&hm=897cd5e84e86da12ce7c41975f8c4b87850d115adaeab675f7aff5bc32bb3190&=&format=webp&quality=lossless&width=621&height=888", socials: { website: "#" } },
                // PARENT: JUDGEMENT
                { id: 20, title: { en: "XX. Judgement", ko: "XX. 심판", ja: "XX. 審判" }, artist: "Various", description: { en: "Rebirth.", ko: "부활.", ja: "復活。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291614522310743/judgement.png?ex=695b7814&is=695a2694&hm=0a7d33974a526bd7ced496e466436364601b63385ad2b76b368e3a71f94e2ba7&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "#" } },
                { id: 21, title: { en: "XXI. The World", ko: "XXI. 세계", ja: "XXI. 世界" }, artist: "Rou Rou", description: { en: "Completion.", ko: "완성.", ja: "完成。" }, image: "https://media.discordapp.net/attachments/1457280504758800384/1457291883305762868/theworld.png?ex=695b7854&is=695a26d4&hm=3d593799c65280890c5de9a1e69dbeb45a7c8df00c4b8398508a858bc1af2645&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "#" } }
            ],
            EMPLOYEES: [
                // 0. THE FOOL
                { cardId: 0, no: "0", card: "The Fool", char: "Hod", artist: "Herokatz", pen: "herocatz", role: "Geologist", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291783980453950/thefool.png?ex=695b783c&is=695a26bc&hm=001bcaf51a19d113300f0bb96f8642f6cb81c3aa3681c1295b8a822d09e74ebd&=&format=webp&quality=lossless&width=623&height=887", socials: { twitter: "https://x.com/AhoHeroCatz" } },
                
                // I. THE MAGICIAN
                { cardId: 1, no: "1", card: "The Magician", char: "Tellulu", artist: "Violetta", pen: "Violetta", role: "Magician", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291820089217129/themagician.png?ex=695b7845&is=695a26c5&hm=b005def9f5af1d209d9622696a316e492597370710ba8d5a927f40635bdafe47&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/violetta25sora", instagram: "https://instagram.com/violetta25sora" } },
                
                // II. HIGH PRIESTESS
                { cardId: 2, no: "2", card: "The High Priestess", char: "Faust", artist: "Sinn/Square", pen: "19sinnt", role: "Unemployed", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291800124326143/thehighpriestess.png?ex=695b7840&is=695a26c0&hm=0e6c3342ab9256b509bafffd93a2220e210eba589e73fce583565c4b3c4b9fe8&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/19sinnt" } },
                
                // III. THE EMPRESS (Variants)
                { cardId: 3, no: "3", card: "The Empress", char: "Carmen", artist: "Uni", pen: "Uni_teto", role: "Librarian", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291765425115177/theempress1.png?ex=695b7838&is=695a26b8&hm=29a5917cd20c2ac27229e4343715adb94efa2a11a01ffc80c7baf926e17f6643&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "https://instagram.com/uni_teto0o0o" } },
                { cardId: 3, no: "3", card: "The Empress", char: "Ryoshu", artist: "miyo", pen: "Lets_lament", role: "The bus lamenter", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291756134732000/theempress.png?ex=695b7835&is=695a26b5&hm=dea355082beb675c1157967f338ebde79a50667f738f9b1432ca98ffef5d8633&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "https://x.com/lets_lam3nt" } },
                
                // IV. THE EMPEROR
                { cardId: 4, no: "4", card: "The Emperor", char: "Ayin", artist: "Sierra", pen: "seikanaru", role: "Grade 9 fixer", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291749406801951/theemperor.png?ex=695b7834&is=695a26b4&hm=f718477ad5b8c96821b37b4537ece57a3668b13623aeced4eca930e243c02457&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "https://instagram.com/seikanaru" } },

                // V. THE HIEROPHANT
                { cardId: 5, no: "5", card: "The Hierophant", char: "Meursault", artist: "Vel", pen: "Vel zeGret", role: "Dieci fixer", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291790913900778/thehierophant.png?ex=695b783e&is=695a26be&hm=483e669d9d2bd88adefbc6a4969dc6986d47c7f46555b734cab36c04946a5955&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/velzegret_art" } },
                
                // VI. THE LOVERS
                { cardId: 6, no: "6", card: "The Lovers", char: "Ghost&doll", artist: "33", pen: "biexuejianzhu", role: "Rubber human", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291809041547407/thelovers.png?ex=695b7842&is=695a26c2&hm=f2885a553bda976d93b8bf681a0c24a5596088b03cb50808327999263c13bb28&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "https://x.com/biexuejianzhu" } },
                
                // VII. THE CHARIOT
                { cardId: 7, no: "7", card: "The Chariot", char: "Outis", artist: "Moozy", pen: "moozyfreak", role: "Gunner", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291726241792144/thechariot.png?ex=695b782e&is=695a26ae&hm=acfd8f9edae193535598289690bc1972de00f1a7c3994601fe56d309ae7437c1&=&format=webp&quality=lossless&width=621&height=887", socials: { instagram: "https://instagram.com/goodmorningtonite" } },
                
                // VIII. STRENGTH
                { cardId: 8, no: "8", card: "Strength", char: "The red mist", artist: "Steph", pen: "A_Secret", role: "L Corp remnant", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291651352367165/strength.png?ex=695b781c&is=695a269c&hm=e752c2b4a42892763cb82290c9ecaaf9af51a816c2ac5f856e4cb194f90069b7&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "https://x.com/A_Secret" } },
                
                // IX. THE HERMIT
                { cardId: 9, no: "9", card: "The Hermit", char: "Yi Sang", artist: "Karrii", pen: "Cheriishu_", role: "the middle little sister", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291716498427985/the_hermit.png?ex=695b782c&is=695a26ac&hm=e25ab6e918f2f2e6e1902b8353b8d4aa3b31026f2fffc4069c25c2f711952184&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "https://x.com/Shinnigummy", instagram: "https://instagram.com/Cheriishu_" } },
                
                // X. WHEEL OF FORTUNE
                { cardId: 10, no: "10", card: "Wheel of Fortune", char: "Hokma", artist: "Victor", pen: "Soukoku4life", role: "Archivist", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291897709264999/wheeloffortune.png?ex=695b7857&is=695a26d7&hm=5d489da6ba134349dc24a589de15dbd776070b5d435be86335bd4c3f3bfe20b7&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/Soukoku4life" } },
                
                // XI. JUSTICE
                { cardId: 11, no: "11", card: "Justice", char: "Sancho", artist: "Ruri", pen: "Kaname Ruri", role: "La manchaland’s bloodbag", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291642938851504/justice.png?ex=695b781a&is=695a269a&hm=40bb52d3802408a42a2bc9545aa3d03ffdefeb406b288c17ee1ce0f0f3e06ccf&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/kaname_ruri" } },
                
                // XII. HANGED MAN
                { cardId: 12, no: "12", card: "The Hanged Man", char: "Lefty", artist: "Muta", pen: "myonkill", role: "Watchdog", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291787122249834/thehangingman.png?ex=695b783d&is=695a26bd&hm=6bb06a21e30bda7799f76151507dc5b3d03022e3efedcb87caea02537bc0c29d&=&format=webp&quality=lossless&width=369&height=525", socials: { twitter: "https://x.com/myonkill" } },
                
                // XIII. DEATH (Variants)
                { cardId: 13, no: "13", card: "Death", char: "Argalia", artist: "Meowtail", pen: "gh0stcarnival", role: "LCE researcher", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291592627912725/death.png?ex=695b780e&is=695a268e&hm=0918fe520d72796a0f6ab998f7627b5651a8f01a77ad64037354e618b8f370e7&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "https://x.com/gh0stcarnival" } },
                { cardId: 13, no: "13", card: "Death", char: "Angela", artist: "Sin", pen: "scoliosin", role: "Mechanic", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291604812365886/death1.png?ex=695b7811&is=695a2691&hm=43fe42a82c5e885f8b2967bc59ba3c0cdd78b37674f53d539a6ae1bd2530255f&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "https://x.com/scoliosin" } },
                
                // XIV. TEMPERANCE
                { cardId: 14, no: "14", card: "Temperance", char: "Hong Lu", artist: "Kali", pen: "KαlliΩpe", role: "Fixer", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291701071904921/temperance.png?ex=695b7828&is=695a26a8&hm=eab4d05f0a9038a9c0a1f80feb8abed10d5467752cea1f206f9c29f7e4ad8921&=&format=webp&quality=lossless&width=623&height=887", socials: { instagram: "https://instagram.com/KαlliΩpe" } },
                
                // XV. THE DEVIL
                { cardId: 15, no: "15", card: "The Devil", char: "Bong Bong", artist: "oob", pen: "Oober", role: "K2 researcher", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291738660999270/thedevil.png?ex=695b7831&is=695a26b1&hm=a594536ea612504133ff0da8ba1e60f371c724bbb0faa857cd16598fc704cb80&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "https://x.com/Oober" } },
                
                // XVI. THE TOWER (Variants)
                { cardId: 16, no: "16", card: "The Tower", char: "Xiao", artist: "Sajoy", pen: "Sajoyvy", role: "Hamhampangpang food tester", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291865241030881/thetower.png?ex=695b784f&is=695a26cf&hm=75515b87aab92e64d76b202c6ce61884baf4b8947e16bb93a30baf9bbd76e7cc&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/Zukinan_" } },
                { cardId: 16, no: "16", card: "The Tower", char: "Haehwan", artist: "Poyo", pen: "minialily", role: "Moon light bird", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291874514767893/thetower1.png?ex=695b7852&is=695a26d2&hm=bca01d9bda85df7dd3c88f37cd5b24a29f7a15134e5940c07ae1878b2161e837&=&format=webp&quality=lossless&width=623&height=888", socials: { twitter: "https://x.com/minialily" } },
                
                // XVII. THE STAR
                { cardId: 17, no: "17", card: "The Star", char: "Don", artist: "Wenli", pen: "eyesbuttered", role: "The only grade 10 fixer", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291847507644416/thestar.png?ex=695b784b&is=695a26cb&hm=2aefbbe0ee3080d01261d2129d6350f9e91e03317ea1d41070fe3c02f6fb47a4&=&format=webp&quality=lossless&width=621&height=888", socials: { instagram: "https://instagram.com/eyesbuttered" } },
                
                // XVIII. THE MOON (Variants)
                { cardId: 18, no: "18", card: "The Moon", char: "Rodion", artist: "Laser", pen: "Laser覚明", role: "Mysterious Intern", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291828171640958/themoon.png?ex=695b7847&is=695a26c7&hm=80e9554561c3d45d8fdabb3b6070d891c3b85a55780e60db40602a702f691c6f&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "https://x.com/Juemingziwww" } },
                { cardId: 18, no: "18", card: "The Moon", char: "Torino", artist: "Muta", pen: "myonkill", role: "Unknown", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291836908638391/themoon1.png?ex=695b7849&is=695a26c9&hm=ec8b83ac9e3ee9a168675f359bfd9ee6e48ef909e03e2ec583f7f9428fb9461d&=&format=webp&quality=lossless&width=621&height=887", socials: { twitter: "https://x.com/myonkill" } },
                
                // XIX. THE SUN
                { cardId: 19, no: "19", card: "The Sun", char: "Ishmeal", artist: "Accio", pen: "urchinspines", role: "The ring pontilist student", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291855598325843/thesun.png?ex=695b784d&is=695a26cd&hm=897cd5e84e86da12ce7c41975f8c4b87850d115adaeab675f7aff5bc32bb3190&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/kamiyamahigh" } },
                
                // XX. JUDGEMENT (Variants)
                { cardId: 20, no: "20", card: "Judgment", char: "Sinclair", artist: "Nori", pen: "Nor1san23", role: "LCE", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291614522310743/judgement.png?ex=695b7814&is=695a2694&hm=0a7d33974a526bd7ced496e466436364601b63385ad2b76b368e3a71f94e2ba7&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/Nor1san23" } },
                { cardId: 20, no: "20", card: "Judgement", char: "Binah", artist: "Tako", pen: "tako0mari", role: "Arbiter", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291624538443957/judgement1.png?ex=695b7816&is=695a2696&hm=0e32fe853cc2fea810bdaa142c365532f8934a3e140e11671a9f5149426db288&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/tako0mari" } },
                { cardId: 20, no: "20", card: "Judgment", char: "Purple Girl", artist: "Ooya", pen: "OOYA", role: "Milk delivery person", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291633044488349/judgment2.png?ex=695b7818&is=695a2698&hm=ec83bde951acdac9345b5c7110eefea559d5d7802d272584105305ae996cb194&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/July_26_" } },
                
                // XXI. THE WORLD
                { cardId: 21, no: "21", card: "The World", char: "Excalibur", artist: "Rou Rou", pen: "RouRou", role: "Florist", variantImage: "https://media.discordapp.net/attachments/1457280504758800384/1457291883305762868/theworld.png?ex=695b7854&is=695a26d4&hm=3d593799c65280890c5de9a1e69dbeb45a7c8df00c4b8398508a858bc1af2645&=&format=webp&quality=lossless&width=621&height=888", socials: { twitter: "https://x.com/rousheep" } }
            ],
            TRANSLATIONS: {
                // ... existing translations ...
                en: {
                    // ... existing ...
                    btn_visit: "[ VISIT LINK ]",
                    btn_email: "[ SEND TRANSMISSION ]",
                    btn_rotate: "ROTATE",
                    // btn_mode_switch and btn_ui_mode replaced by dynamic logic
                    ui_mode_desktop: "VIEW: DESKTOP",
                    ui_mode_mobile: "VIEW: MOBILE",
                    btn_system: "SYSTEM",
                    // ... existing ...
                },
                ko: {
                    // ... existing ...
                    btn_visit: "[ 링크 방문 ]",
                    btn_email: "[ 전송 ]",
                    btn_rotate: "회전",
                    ui_mode_desktop: "화면: 데스크탑",
                    ui_mode_mobile: "화면: 모바일",
                    btn_system: "시스템",
                    // ... existing ...
                },
                ja: {
                    // ... existing ...
                    btn_visit: "[ リンクへ ]",
                    btn_email: "[ 送信 ]",
                    btn_rotate: "回転",
                    ui_mode_desktop: "表示: デスクトップ",
                    ui_mode_mobile: "表示: モバイル",
                    btn_system: "システム",
                    // ... existing ...
                }
            }
        };

        // --- 2. MANAGERS (Modular Logic) ---

        // Audio Manager
        const AudioManager = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            masterGain: null,
            userInteracted: false,
            playlist: [
                { title: "ATMOSPHERE: NEON_TEARS", type: "gen", theme: "atmosphere" },
                { title: "TUNE: 8-BIT_SUNSHINE", type: "gen", theme: "cheerful" },
                { title: "WARNING: ABYSSAL_GLITCH", type: "gen", theme: "scary" },
                { title: "TUNE: KAWAII_CIRCUIT", type: "gen", theme: "cute" },
                { title: "SEQ: CYBER_CHASE", type: "gen", theme: "cyber" }
            ],
            currentTrackIdx: 0,
            isPlaying: false,
            synthInterval: null,

            init() {
                this.masterGain = this.ctx.createGain();
                this.masterGain.connect(this.ctx.destination);
                this.masterGain.gain.value = 0.4;

                // Delay FX
                const delay = this.ctx.createDelay();
                delay.delayTime.value = 0.4;
                const feedback = this.ctx.createGain();
                feedback.gain.value = 0.3;
                const filter = this.ctx.createBiquadFilter();
                filter.frequency.value = 2000;

                delay.connect(feedback);
                feedback.connect(filter);
                filter.connect(delay);
                delay.connect(this.masterGain);

                // Interaction listener
                document.addEventListener('click', () => { 
                    this.userInteracted = true; 
                    if (this.ctx.state === 'suspended') this.ctx.resume().catch(()=>{});
                }, { once: true });
            },

            play(type) {
                if (!this.userInteracted && type === 'hover') return;
                if (this.ctx.state === 'suspended') this.ctx.resume().catch(()=>{});

                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.masterGain);
                const now = this.ctx.currentTime;
                
                // --- MEMORY OPTIMIZATION: Disconnect nodes after playing ---
                const cleanup = () => {
                    setTimeout(() => {
                        osc.disconnect();
                        gain.disconnect();
                    }, 2000); // Buffer time to ensure sound finished
                };
                
                // Fallback cleanup if onended misses (rare but safe)
                cleanup();
                
                osc.onended = () => {
                   osc.disconnect();
                   gain.disconnect();
                };

                if (type === 'hover') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, now);
                    osc.frequency.exponentialRampToValueAtTime(800, now + 0.05);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);
                    osc.start(now); osc.stop(now + 0.05);
                } else if (type === 'click') {
                    osc.type = 'square';
                    osc.frequency.setValueAtTime(200, now);
                    osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                    osc.start(now); osc.stop(now + 0.1);
                } else if (type === 'open') {
                    osc.type = 'triangle';
                    osc.frequency.setValueAtTime(300, now);
                    osc.frequency.linearRampToValueAtTime(600, now + 0.1);
                    gain.gain.setValueAtTime(0.05, now);
                    gain.gain.linearRampToValueAtTime(0.001, now + 0.2);
                    osc.start(now); osc.stop(now + 0.2);
                } else if (type === 'login') {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(100, now);
                    osc.frequency.exponentialRampToValueAtTime(800, now + 0.5);
                    gain.gain.setValueAtTime(0.1, now);
                    gain.gain.linearRampToValueAtTime(0, now + 1.5);
                    osc.start(now); osc.stop(now + 1.5);
                }
            },

            // Synth Logic (Simplified for brevity but functional)
            playNote(freq, type, duration, vol=0.1) {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.value = freq;
                osc.connect(gain);
                gain.connect(this.masterGain);
                const now = this.ctx.currentTime;
                
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(vol, now + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
                
                osc.start(now);
                osc.stop(now + duration + 0.1);
                
                // --- MEMORY OPTIMIZATION ---
                setTimeout(() => { 
                    osc.disconnect(); 
                    gain.disconnect(); 
                }, (duration + 0.2) * 1000);
            },

            startSynth(theme) {
                if(this.synthInterval) clearInterval(this.synthInterval);
                const play = this.playNote.bind(this);
                
                if (theme === 'atmosphere') {
                    this.synthInterval = setInterval(() => {
                        play(130 + Math.random()*100, 'sawtooth', 4.0, 0.05);
                    }, 3000);
                } else {
                    // Default fallback beat
                    this.synthInterval = setInterval(() => {
                        play(200 + Math.random()*200, 'sine', 0.5, 0.05);
                    }, 500);
                }
            },

            stopSynth() {
                if(this.synthInterval) clearInterval(this.synthInterval);
            },

            toggle() {
                const icon = document.getElementById('play-icon');
                const vis = document.getElementById('visualizer');
                
                if (this.isPlaying) {
                    this.stopSynth();
                    this.isPlaying = false;
                    vis.classList.remove('playing');
                    icon.setAttribute('data-lucide', 'play');
                } else {
                    const track = this.playlist[this.currentTrackIdx];
                    this.startSynth(track.theme);
                    this.isPlaying = true;
                    vis.classList.add('playing');
                    icon.setAttribute('data-lucide', 'pause');
                }
                lucide.createIcons({ root: document.getElementById('win-audio') });
            },

            next() {
                this.currentTrackIdx = (this.currentTrackIdx + 1) % this.playlist.length;
                this.loadTrack();
                if(this.isPlaying) this.toggle(); // Restart
                setTimeout(() => this.toggle(), 100);
            },

            prev() {
                this.currentTrackIdx = (this.currentTrackIdx - 1 + this.playlist.length) % this.playlist.length;
                this.loadTrack();
                if(this.isPlaying) this.toggle();
                setTimeout(() => this.toggle(), 100);
            },

            loadTrack() {
                const track = this.playlist[this.currentTrackIdx];
                document.getElementById('audio-track-name').innerText = track.title;
            }
        };

        // --- NEW: 3D VIEWER MANAGER ---
        const Viewer3D = {
            state: {
                scale: 1,
                rotX: 0,
                rotY: 0,
                isDragging: false,
                startX: 0,
                startY: 0,
                currentX: 0,
                currentY: 0,
                // Throttling state
                ticking: false,
                lastDeltaX: 0,
                lastDeltaY: 0
            },
            
            init() {
                const stage = document.getElementById('viewer-stage');
                
                // Mouse Events
                stage.addEventListener('mousedown', (e) => this.startDrag(e));
                window.addEventListener('mousemove', (e) => this.drag(e));
                window.addEventListener('mouseup', () => this.endDrag());
                
                // Touch Events (Mobile)
                stage.addEventListener('touchstart', (e) => this.startDrag(e), {passive: false});
                window.addEventListener('touchmove', (e) => this.drag(e), {passive: false});
                window.addEventListener('touchend', () => this.endDrag());

                // Wheel Zoom
                stage.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const delta = e.deltaY > 0 ? -0.1 : 0.1;
                    this.adjustZoom(delta);
                }, {passive: false});
            },

            reset() {
                this.state = { 
                    scale: 1, rotX: 0, rotY: 0, 
                    isDragging: false, startX: 0, startY: 0, 
                    currentX: 0, currentY: 0,
                    ticking: false, lastDeltaX: 0, lastDeltaY: 0
                };
                this.updateTransform();
            },

            adjustZoom(delta) {
                let newScale = this.state.scale + delta;
                // Clamp zoom level (0.5x to 3.0x)
                if (newScale < 0.5) newScale = 0.5;
                if (newScale > 3.0) newScale = 3.0;
                
                this.state.scale = newScale;
                this.updateTransform();
            },

            startDrag(e) {
                // Ignore if clicking buttons
                if (e.target.closest('.viewer-controls-overlay')) return;
                
                e.preventDefault(); // Prevent text selection
                this.state.isDragging = true;
                
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                
                this.state.startX = clientX;
                this.state.startY = clientY;
                
                // Cache current rotation start point
                this.state.currentX = this.state.rotY; // X movement affects Y rotation
                this.state.currentY = this.state.rotX; // Y movement affects X rotation
                
                const stage = document.getElementById('viewer-stage');
                if (stage) stage.style.cursor = 'grabbing';
            },

            drag(e) {
                if (!this.state.isDragging) return;
                
                const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                
                // Update latest deltas
                this.state.lastDeltaX = clientX - this.state.startX;
                this.state.lastDeltaY = clientY - this.state.startY;
                
                // Throttle the actual update
                if (!this.state.ticking) {
                    requestAnimationFrame(() => {
                        this.updatePosition();
                        this.state.ticking = false;
                    });
                    this.state.ticking = true;
                }
            },

            updatePosition() {
                const speed = 0.5;
                this.state.rotY = this.state.currentX + (this.state.lastDeltaX * speed);
                this.state.rotX = this.state.currentY - (this.state.lastDeltaY * speed); // Invert Y axis
                this.updateTransform();
            },

            endDrag() {
                this.state.isDragging = false;
                this.state.ticking = false;
                const stage = document.getElementById('viewer-stage');
                if (stage) stage.style.cursor = 'grab';
            },

            updateTransform() {
                const wrapper = document.getElementById('viewer-card-wrapper');
                if (!wrapper) return;
                
                // Apply transforms
                wrapper.style.transform = `
                    scale(${this.state.scale}) 
                    rotateX(${this.state.rotX}deg) 
                    rotateY(${this.state.rotY}deg)
                `;
                
                // Update UI display
                const zoomVal = document.getElementById('zoom-val');
                if (zoomVal) zoomVal.innerText = Math.round(this.state.scale * 100) + '%';
            }
        };

        // Window Manager
        const WindowManager = {
            zIndex: 100,
            maximizedState: {}, // Store previous positions
            
            open(id) {
                const win = document.getElementById(id);
                if (!win) return;
                
                win.classList.remove('minimized');
                win.style.display = 'flex';
                this.bringToFront(win);
                
                // Update Taskbar
                this.updateTaskbar();
                AudioManager.play('open');
                
                // Initial icon scan
                lucide.createIcons({ root: win });
            },

            close(id) {
                const win = document.getElementById(id);
                if (!win) return;
                
                win.style.display = 'none';
                win.classList.remove('active', 'minimized');
                // Optional: Reset maximization state on close? 
                // Currently keeping state so it reopens how you left it, or we can reset.
                // Resetting maximization visual state if desired, but retaining logic.
                
                this.updateTaskbar();
                AudioManager.play('click');
            },

            minimize(id) {
                const win = document.getElementById(id);
                if (!win) return;
                
                win.classList.add('minimized');
                win.classList.remove('active');
                this.updateTaskbar();
                AudioManager.play('click');
            },

            toggleMaximize(id) {
                const win = document.getElementById(id);
                if (!win) return;

                if (win.classList.contains('maximized')) {
                    // RESTORE
                    win.classList.remove('maximized');
                    const state = this.maximizedState[id] || {};
                    
                    // Apply stored styles or fallback
                    win.style.top = state.top || '10%';
                    win.style.left = state.left || '10%';
                    win.style.width = state.width || '600px';
                    win.style.height = state.height || '500px';
                    
                } else {
                    // MAXIMIZE
                    // Store current state before maximizing
                    this.maximizedState[id] = {
                        top: win.style.top,
                        left: win.style.left,
                        width: win.style.width,
                        height: win.style.height
                    };

                    win.classList.add('maximized');
                    
                    // Dimensions based on layout: Top Bar 70px, Taskbar 55px
                    // Top position should be 70px
                    // Height should be 100vh - 70px - 55px = calc(100% - 125px)
                    win.style.top = '70px';
                    win.style.left = '0';
                    win.style.width = '100%';
                    win.style.height = 'calc(100% - 125px)';
                }
                
                this.bringToFront(win);
                AudioManager.play('click');
            },

            bringToFront(win) {
                this.zIndex++;
                win.style.zIndex = this.zIndex;
                document.querySelectorAll('.os-window').forEach(w => w.classList.remove('active'));
                win.classList.add('active');
                this.updateTaskbar();
            },

            showDesktop() {
                document.querySelectorAll('.os-window').forEach(win => {
                    this.minimize(win.id);
                });
                AudioManager.play('click');
            },

            updateTaskbar() {
                const list = document.getElementById('task-list');
                list.innerHTML = '';
                
                document.querySelectorAll('.os-window').forEach(win => {
                    if (win.style.display === 'flex' || win.classList.contains('minimized')) {
                        const item = document.createElement('div');
                        item.className = 'task-item';
                        item.tabIndex = 0;
                        item.role = 'button';
                        if (win.classList.contains('active') && !win.classList.contains('minimized')) {
                            item.classList.add('active');
                        }
                        
                        const title = win.querySelector('.win-title').innerText;
                        item.innerText = title.substring(0, 12) + (title.length > 12 ? '...' : '');
                        
                        const activate = () => {
                            if (win.classList.contains('active') && !win.classList.contains('minimized')) {
                                this.minimize(win.id);
                            } else {
                                this.open(win.id);
                            }
                        };
                        
                        item.onclick = activate;
                        item.onkeydown = (e) => { if(e.key==='Enter'||e.key===' ') activate(); };
                        item.onmouseenter = () => AudioManager.play('hover');
                        
                        list.appendChild(item);
                    }
                });
            }
        };

        // System / App Logic
        const System = {
            lang: 'en',
            loginTimer: null, // Timer for auto-login logic
            
            init() {
                AudioManager.init();
                this.setupDrag();
                this.setupListeners();
                
                // Initial Mobile Check & UI Update
                this.checkMobile(); 
                
                Viewer3D.init(); // Initialize the 3D Viewer listeners
                window.addEventListener('resize', () => {
                    this.checkMobile();
                });
                
                // Start the auto-login countdown
                this.startAutoLoginTimer();

                // Clock & Widget Loop
                setInterval(() => {
                    // Update Clock
                    document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-US', { hour12: false });
                    
                    // Signal Widget Logic
                    const latency = Math.floor(Math.random() * (55 - 24 + 1) + 24);
                    document.getElementById('sig-latency').innerText = latency + "ms";
                    
                    const chars = "ABCDEF0123456789";
                    let hash = "";
                    for(let i=0; i<4; i++) hash += chars.charAt(Math.floor(Math.random() * chars.length));
                    hash += "-";
                    for(let i=0; i<4; i++) hash += chars.charAt(Math.floor(Math.random() * chars.length));
                    document.getElementById('enc-hash-display').innerText = hash;

                    // Update Countdowns
                    this.updateCountdowns();

                }, 1000);

                // Initial Render
                lucide.createIcons();
                this.renderGrid();
            },

            updateCountdowns() {
                const now = new Date().getTime();
                
                // Event 1: Lunatic Moonlight - 15 Feb 2026, 11:30 AM (Tokyo UTC+9)
                const evt1 = new Date('2026-02-15T11:30:00+09:00').getTime();
                
                // Event 2: One Million Moon - 21 Feb 2026, 12:00 PM (Tokyo UTC+9 assumption)
                const evt2 = new Date('2026-02-21T12:00:00+09:00').getTime();

                const updateElement = (id, targetTime) => {
                    const el = document.getElementById(id);
                    if(!el) return;
                    
                    const diff = targetTime - now;
                    
                    if (diff < 0) {
                        el.innerText = "STATUS: CONCLUDED";
                        el.style.color = "#666";
                        el.style.borderColor = "#666";
                        el.style.background = "rgba(0,0,0,0.5)";
                        return;
                    }

                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    const secs = Math.floor((diff % (1000 * 60)) / 1000);
                    
                    // Pad with leading zeros for terminal look
                    const p = (n) => n.toString().padStart(2, '0');
                    
                    el.innerText = `T-MINUS: ${days}D ${p(hours)}H ${p(mins)}M ${p(secs)}S`;
                };

                updateElement('countdown-1', evt1);
                updateElement('countdown-2', evt2);
            },

            // --- AUTO LOGIN LOGIC ---
            startAutoLoginTimer() {
                const input = document.getElementById('login-input');
                if (!input) return;

                // Wait 5 seconds before triggering auto-fill
                this.loginTimer = setTimeout(() => {
                    if (input.value.trim() === '') {
                        this.performAutoFill();
                    }
                }, 5000);
            },

            performAutoFill() {
                const input = document.getElementById('login-input');
                const wrapper = document.getElementById('login-wrapper');
                if (!input) return;

                const code = "DISTORTIONDIVINA";
                let i = 0;
                
                // Visual focus
                if(wrapper) wrapper.classList.add('focused');

                // Ghost typing effect
                const typeInterval = setInterval(() => {
                    if (i < code.length) {
                        input.value += code.charAt(i);
                        i++;
                    } else {
                        clearInterval(typeInterval);
                        setTimeout(() => this.login(), 400);
                    }
                }, 60); // Speed of auto-typing
            },

            checkMobile() {
                // Determine if mobile based on UA or Width
                const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) || window.innerWidth < 768;
                
                // Only toggle class if it matches the detection to avoid overriding manual toggles unpredictably on resize
                // However, for consistency, let's sync class with state
                document.body.classList.toggle('is-mobile', isMobile);
                
                this.updateModeButtons();
            },

            toggleMode() {
                document.body.classList.toggle('is-mobile');
                this.updateModeButtons();
                AudioManager.play('click');
            },

            updateModeButtons() {
                const isMobile = document.body.classList.contains('is-mobile');
                const labels = DB.TRANSLATIONS[this.lang];
                const btns = document.querySelectorAll('.mode-switch-btn');

                btns.forEach(btn => {
                    if (isMobile) {
                        // Current state is MOBILE
                        btn.innerHTML = `<i data-lucide="smartphone" width="18"></i> ${labels.ui_mode_mobile}`;
                    } else {
                        // Current state is DESKTOP
                        btn.innerHTML = `<i data-lucide="monitor" width="18"></i> ${labels.ui_mode_desktop}`;
                    }
                });
                
                // Refresh icons for the newly injected HTML
                if (window.lucide) lucide.createIcons();
            },

            setLanguage(lang) {
                this.lang = lang;
                
                // Update buttons active state
                document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
                const activeBtn = Array.from(document.querySelectorAll('.lang-btn'))
                    .find(b => b.innerText.toLowerCase().includes(lang === 'en' ? 'en' : (lang === 'ko' ? '한국어' : '日本語')));
                if (activeBtn) activeBtn.classList.add('active');

                // Update standard i18n text
                document.querySelectorAll('[data-i18n]').forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (DB.TRANSLATIONS[lang][key]) {
                        el.innerText = DB.TRANSLATIONS[lang][key];
                    }
                });
                
                // Re-update dynamic mode buttons to apply new language
                this.updateModeButtons();
                
                // Update JS-driven content
                this.renderGrid();
                this.updateCountdowns();
            },

            login() {
                const input = document.getElementById('login-input');
                const wrapper = document.getElementById('login-wrapper');
                const msg = document.getElementById('login-message');

                // Visual Feedback
                wrapper.classList.add('focused');
                msg.style.opacity = '1';
                msg.innerText = "VERIFYING CREDENTIALS...";
                msg.style.color = "var(--gold-primary)";
                AudioManager.play('login');

                // Simulate processing delay
                setTimeout(() => {
                    msg.innerText = DB.TRANSLATIONS[this.lang].access_granted;
                    msg.style.color = "var(--terminal-green)";
                    msg.style.textShadow = "0 0 10px var(--terminal-green)";
                    
                    wrapper.style.borderColor = "var(--terminal-green)";
                    input.style.color = "var(--terminal-green)";
                    
                    setTimeout(() => {
                        const login = document.getElementById('login-screen');
                        login.style.opacity = '0';
                        setTimeout(() => {
                            login.style.display = 'none';
                            document.getElementById('desktop-screen').classList.add('active');
                            setTimeout(() => WindowManager.open('win-overview'), 800);
                            this.initAssistant();
                        }, 1000);
                    }, 1000);
                }, 800);
            },

            toggleMode() {
                document.body.classList.toggle('is-mobile');
                AudioManager.play('click');
            },

            toggleRotation() {
                document.getElementById('app-container').classList.toggle('rotated');
                AudioManager.play('click');
            },

            setupListeners() {
                // Login Input Listener
                const loginInput = document.getElementById('login-input');
                if(loginInput) {
                    loginInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            System.login();
                        }
                    });
                    
                    // CANCEL AUTO-LOGIN if user starts typing manually
                    loginInput.addEventListener('input', () => {
                        if (this.loginTimer) {
                            clearTimeout(this.loginTimer);
                            this.loginTimer = null;
                        }
                    });
                    
                    // Auto-focus on load
                    loginInput.focus();
                    
                    // Visual focus states
                    loginInput.addEventListener('focus', () => {
                        document.getElementById('login-wrapper').classList.add('focused');
                    });
                    loginInput.addEventListener('blur', () => {
                        document.getElementById('login-wrapper').classList.remove('focused');
                    });
                }

                // Desktop Icons
                document.querySelectorAll('.desktop-icon').forEach(icon => {
                    const winId = icon.getAttribute('data-window');
                    const open = () => WindowManager.open(winId);
                    icon.onclick = open;
                    icon.onkeydown = (e) => { if(e.key==='Enter'||e.key===' ') open(); };
                    icon.onmouseenter = () => AudioManager.play('hover');
                });

                // Window Focus
                document.querySelectorAll('.os-window').forEach(win => {
                    win.addEventListener('mousedown', () => WindowManager.bringToFront(win));
                });
            },

            setupDrag() {
                let isDragging = false;
                let currentWindow = null;
                let dragOffsetX = 0;
                let dragOffsetY = 0;
                
                // Throttling state variables
                let targetX = 0;
                let targetY = 0;
                let isFrameRequested = false;

                const start = (e) => {
                    if (e.target.closest('.win-controls')) return; // Don't drag if clicking controls
                    if (document.body.classList.contains('is-mobile')) return;
                    
                    const win = e.target.closest('.os-window');
                    if (!win || !e.target.closest('.window-header')) return;

                    isDragging = true;
                    currentWindow = win;
                    WindowManager.bringToFront(win);
                    
                    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                    const rect = win.getBoundingClientRect();
                    dragOffsetX = clientX - rect.left;
                    dragOffsetY = clientY - rect.top;
                    AudioManager.play('click');
                };

                const updatePosition = () => {
                    if (!currentWindow || !isDragging) {
                        isFrameRequested = false;
                        return;
                    }
                    
                    // Boundary checks (simple clamp)
                    let finalX = targetX < 0 ? 0 : targetX;
                    let finalY = targetY < 30 ? 30 : targetY; // Keep below top bar
                    
                    currentWindow.style.left = finalX + 'px';
                    currentWindow.style.top = finalY + 'px';
                    
                    isFrameRequested = false;
                };

                const move = (e) => {
                    if (!isDragging || !currentWindow) return;
                    e.preventDefault();
                    
                    const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
                    const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
                    
                    targetX = clientX - dragOffsetX;
                    targetY = clientY - dragOffsetY;

                    // Throttle updates using requestAnimationFrame pattern
                    if (!isFrameRequested) {
                        isFrameRequested = true;
                        requestAnimationFrame(updatePosition);
                    }
                };

                const end = () => { isDragging = false; currentWindow = null; isFrameRequested = false; };

                document.addEventListener('mousedown', start);
                document.addEventListener('touchstart', start, {passive: false});
                document.addEventListener('mousemove', move);
                document.addEventListener('touchmove', move, {passive: false});
                document.addEventListener('mouseup', end);
                document.addEventListener('touchend', end);
            },

            // --- RENDER LOGIC ---
            renderGrid() {
                const grid = document.getElementById('cardGrid');
                grid.innerHTML = '';
                DB.CARDS.forEach(card => {
                    const el = document.createElement('div');
                    el.className = 'card-file';
                    el.tabIndex = 0;
                    el.role = 'button';
                    
                    // Improved Lazy Load: Init hidden, fade in on load
                    el.innerHTML = `
                        <img src="${card.image}" class="img-loading" loading="lazy" onload="this.classList.add('img-loaded')" onerror="this.src='https://placehold.co/400x600/000/333?text=ERR'">
                        <div class="file-label">${card.title[this.lang]}</div>
                    `;
                    const action = () => { this.openSelector(card); AudioManager.play('click'); };
                    el.onclick = action;
                    el.onkeydown = (e) => { if(e.key==='Enter'||e.key===' ') action(); };
                    el.onmouseenter = () => AudioManager.play('hover');
                    grid.appendChild(el);
                });
                this.renderEmployees();
            },

            renderEmployees() {
                const tbody = document.getElementById('employee-list-body');
                tbody.innerHTML = '';
                DB.EMPLOYEES.forEach(emp => {
                    // Match by cardId
                    const parentCard = DB.CARDS.find(c => c.id === emp.cardId);
                    let title = emp.card;
                    if (parentCard && parentCard.title[this.lang]) {
                        // Extract name portion roughly
                        const parts = parentCard.title[this.lang].split('. ');
                        title = parts.length > 1 ? parts[1] : parentCard.title[this.lang];
                    }

                    const tr = document.createElement('tr');
                    
                    // Added data-labels for Mobile CSS Card View
                    const labels = DB.TRANSLATIONS[this.lang]; // Get current lang labels
                    
                    tr.innerHTML = `
                        <td class="col-no" data-label="${labels.th_no}">${emp.no}</td>
                        <td class="col-card" data-label="${labels.th_card}">${title}</td>
                        <td class="col-char" data-label="${labels.th_char}">${emp.char}</td>
                        <td class="col-emp" data-label="${labels.th_emp}">${emp.artist}</td>
                        <td class="col-pen" data-label="${labels.th_pen}">${emp.pen}</td>
                        <td data-label="${labels.th_role}"><span class="role-badge">${emp.role}</span></td>
                    `;
                    tbody.appendChild(tr);
                });
            },

            openSelector(card) {
                const variants = DB.EMPLOYEES.filter(e => e.cardId === card.id);
                
                // If more than 1 variant, show selector
                if (variants.length > 1) {
                    const grid = document.getElementById('selector-grid');
                    grid.innerHTML = '';
                    document.getElementById('selector-title').innerText = `SELECT: ${card.title[this.lang]}`;

                    variants.forEach(v => {
                        const div = document.createElement('div');
                        div.className = 'variant-card';
                        div.tabIndex = 0;
                        div.role = 'button';
                        
                        const img = v.variantImage || card.image;
                        div.innerHTML = `
                            <div class="variant-img-box"><img src="${img}" onerror="this.src='https://placehold.co/400x600/000/333?text=ERR'"></div>
                            <div class="variant-info">
                                <div class="variant-char">${v.char}</div>
                                <div class="variant-artist">ARTIST: ${v.artist}</div>
                            </div>
                        `;
                        const act = () => { this.openViewer(card, v); AudioManager.play('click'); };
                        div.onclick = act;
                        div.onkeydown = (e) => { if(e.key==='Enter'||e.key===' ') act(); };
                        div.onmouseenter = () => AudioManager.play('hover');
                        grid.appendChild(div);
                    });
                    WindowManager.open('win-selector');
                } else if (variants.length === 1) {
                    this.openViewer(card, variants[0]);
                } else {
                    this.openViewer(card, null);
                }
            },

            openViewer(card, variant) {
                // Reset 3D view every time we open a new card
                Viewer3D.reset();

                const loader = document.getElementById('viewer-loader');
                loader.style.display = 'block';
                
                const imgEl = document.getElementById('viewer-img');
                imgEl.style.opacity = '0';
                
                let src = card.image;
                if (variant && variant.variantImage) src = variant.variantImage;
                
                imgEl.src = src;
                imgEl.onload = () => { 
                    loader.style.display = 'none'; 
                    imgEl.style.opacity = '1'; 
                };

                document.getElementById('viewer-title').innerText = card.title[this.lang];
                document.getElementById('viewer-desc').innerText = card.description[this.lang];
                document.getElementById('viewer-id').innerText = `00${card.id}-ALPHA`;

                const artistDiv = document.getElementById('viewer-artist');
                if (variant) {
                    artistDiv.innerHTML = `
                        <div style="margin-bottom: 20px; border-left: 2px solid var(--gold-primary); padding-left: 15px;">
                            <div style="color: var(--terminal-green); font-size: 0.9rem; text-transform: uppercase; margin-bottom: 6px;">CHARACTER</div>
                            <div style="color: white; font-size: 1.8rem; font-weight: bold; margin-bottom: 12px; font-family: 'Cinzel';">${variant.char}</div>
                            <div style="color: var(--gold-dim); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 4px;">ILLUSTRATOR</div>
                            <div style="color: #ddd; font-size: 1.3rem; margin-bottom: 6px;">${variant.artist}</div>
                            <div style="color: #888; font-size: 0.95rem; font-family: 'Share Tech Mono';">@${variant.pen}</div>
                        </div>
                    `;
                } else {
                    artistDiv.innerHTML = '<div style="color:#888;">No variant data linked.</div>';
                }

                const socials = document.getElementById('viewer-socials');
                socials.innerHTML = '';
                
                // Prioritize variant socials if available, otherwise fallback to card socials
                const displaySocials = (variant && variant.socials) ? variant.socials : card.socials;

                if(displaySocials) {
                    Object.entries(displaySocials).forEach(([k,v]) => {
                        const a = document.createElement('a');
                        a.href = v; 
                        a.target = "_blank"; // Open in new tab
                        a.className = "viewer-social-btn"; // Apply button style
                        
                        let iconName = 'globe';
                        let label = 'WEBSITE';

                        if(k==='twitter') { iconName = 'twitter'; label = 'TWITTER / X'; }
                        if(k==='instagram') { iconName = 'instagram'; label = 'INSTAGRAM'; }
                        if(k==='website') { iconName = 'globe'; label = 'WEBSITE'; }
                        
                        a.innerHTML = `<i data-lucide="${iconName}" width="18" height="18"></i> <span>${label}</span>`;
                        socials.appendChild(a);
                    });
                    // Re-scan for new icons
                    lucide.createIcons({ root: socials });
                }
                
                WindowManager.open('win-viewer');
            },

            // Assistant Logic
            assistantIdx: 0,
            assistantSteps: [
                "Welcome, Agent. I am OOB. I can guide you through the archive.",
                "Click the desktop icons to access classified files. 'PROJECT_BRIEF' contains your mission objectives.",
                "Use 'EMPLOYEE_DB' to view the team roster.",
                "Use 'ARCHIVE_DB' to inspect the tarot artifacts. Click any file to analyze metadata.",
                "Check 'EVENT_LOG' for upcoming timeline incursions and store openings.",
                "You can drag windows to organize your workspace. Good luck."
            ],

            initAssistant() {
                setTimeout(() => {
                    document.getElementById('assistant-overlay').classList.add('active');
                    AudioManager.play('open');
                }, 2000);
            },

            nextAssistantStep() {
                this.assistantIdx++;
                const text = document.getElementById('assistant-text');
                if (this.assistantIdx < this.assistantSteps.length) {
                    text.innerText = this.assistantSteps[this.assistantIdx];
                    AudioManager.play('click');
                } else {
                    this.closeAssistant();
                }
            },

            closeAssistant() {
                document.getElementById('assistant-overlay').classList.remove('active');
                AudioManager.play('click');
            }
        };

        // --- 11. BOOTSTRAP ---
        document.addEventListener('DOMContentLoaded', () => {
            System.init();
        });

    </script>
</body>
</html>